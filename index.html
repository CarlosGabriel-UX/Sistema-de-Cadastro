<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <script>
        // Captura inicial de logs do console para garantir coleta desde o início
        (function(){
            try {
                if (!window.__appLogs) window.__appLogs = [];
                if (window.__wrapConsoleDone) return; // evita múltiplos wraps
                var levels = ['log','info','warn','error','debug'];
                levels.forEach(function(level){
                    var orig = console[level] || console.log;
                    console[level] = function(){
                        try {
                            var args = Array.prototype.slice.call(arguments);
                            var msg = args.map(function(a){
                                try {
                                    if (typeof a === 'string') return a;
                                    if (a instanceof Error) return (a.name+': '+a.message);
                                    return JSON.stringify(a);
                                } catch(e) { return String(a); }
                            }).join(' ');
                            window.__appLogs.push({ level: level, timestamp: new Date().toISOString(), message: msg });
                            if (window.__appLogs.length > 2000) window.__appLogs.shift();
                        } catch(_) {}
                        return orig.apply(console, arguments);
                    };
                });
                window.__wrapConsoleDone = true;
                console.info('Captura de logs iniciada');
                // Global error and promise rejection capture
                (function(){
                    try {
                        if (!window.__errorsCaptureDone) {
                            var push = function(level, message) {
                                try {
                                    window.__appLogs.push({ level: level, timestamp: new Date().toISOString(), message: message });
                                    if (window.__appLogs.length > 2000) window.__appLogs.shift();
                                } catch (_) {}
                            };

                            // Capture resource and runtime errors (capture=true to catch resource load errors)
                            window.addEventListener('error', function(ev) {
                                try {
                                    var target = ev.target || ev.srcElement;
                                    if (target && target.tagName && target !== window) {
                                        var url = target.currentSrc || target.src || target.href || '';
                                        var tag = String(target.tagName || '').toLowerCase();
                                        push('error', 'Resource load error: ' + tag + ' ' + url);
                                    } else {
                                        var msg = ev.message || 'Script error';
                                        var src = ev.filename || '';
                                        var line = ev.lineno || 0;
                                        var col = ev.colno || 0;
                                        var stack = ev.error && ev.error.stack ? ev.error.stack : '';
                                        var text = '[onerror] ' + msg + (src?(' ('+src+':'+line+':'+col+')'):'') + (stack?('\n'+stack):'');
                                        push('error', text);
                                    }
                                } catch(_) {}
                            }, true);

                            // Fallback assignment if no other onerror handler exists
                            if (!window.onerror) {
                                window.onerror = function(message, source, lineno, colno, error) {
                                    var stack = error && error.stack ? '\n'+error.stack : '';
                                    push('error', '[window.onerror] ' + message + (source?(' ('+source+':'+lineno+':'+colno+')'):'') + stack);
                                    return false;
                                };
                            }

                            // Capture unhandled promise rejections
                            window.addEventListener('unhandledrejection', function(ev) {
                                try {
                                    var r = ev.reason;
                                    var msg;
                                    if (r instanceof Error) { msg = r.name + ': ' + r.message + (r.stack?('\n'+r.stack):''); }
                                    else if (typeof r === 'string') { msg = r; }
                                    else { try { msg = JSON.stringify(r); } catch(e) { msg = String(r); } }
                                    push('error', '[unhandledrejection] ' + msg);
                                    console.error('Unhandled rejection:', r);
                                } catch(_) {}
                            });

                            // Fallback assignment if property handler is preferred
                            if (!window.onunhandledrejection) {
                                window.onunhandledrejection = function(ev) {
                                    var r = ev && ev.reason;
                                    var msg = r instanceof Error ? (r.name+': '+r.message) : String(r);
                                    push('error', '[window.onunhandledrejection] ' + msg);
                                    return true;
                                };
                            }

                            window.__errorsCaptureDone = true;
                        }
                    } catch(e) { /* noop */ }
                })();
            } catch (e) { /* noop */ }
        })();
    </script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Sistema de Cadastro de Ocorrências">
    <meta name="author" content="">

    <!-- Removido base href para permitir caminhos relativos sem servidor -->

    <title>Sistema PR7 - Dashboard</title>

    <!-- Custom fonts for this template via CDN -->
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">

    

    <!-- Bootstrap CSS (Local v4.6) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- SB Admin 2 styles -->
    <link href="css/sb-admin-2.min.css" rel="stylesheet">
    
    <!-- Design System Variables -->
    <link href="css/variables.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link href="css/main.css" rel="stylesheet">
    <!-- Component styles -->
    <link href="css/components/buttons.css" rel="stylesheet">
    <link href="css/components/cards.css" rel="stylesheet">
    <link href="css/components/forms.css" rel="stylesheet">
    <link href="css/components/about-pr7.css" rel="stylesheet">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    
    <!-- Mapa Styles -->
    <link href="mapa-styles.css" rel="stylesheet">
    
    <!-- App Custom Styles -->
    <link href="style.css" rel="stylesheet">
    
    <style>
        /* Melhorias visuais profissionais */
        .hover-shadow {
            transition: all 0.3s ease;
        }
        
        .hover-shadow:hover {
            transform: translateY(-2px);
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        }
        
        .card {
            border-radius: 0.75rem;
            border: none;
        }
        
        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white !important;
        }
        
        .card-header h6 {
            color: white !important;
        }
        
        .table thead th {
            background-color: #f8f9fc;
            border-bottom: 2px solid #e3e6f0;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.5px;
        }
        
        .table-hover tbody tr:hover {
            background-color: rgba(78, 115, 223, 0.05);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.15);
        }
        
        .border-left-primary {
            border-left: 0.25rem solid #4e73df !important;
        }
        
        .border-left-success {
            border-left: 0.25rem solid #1cc88a !important;
        }
        
        .border-left-info {
            border-left: 0.25rem solid #36b9cc !important;
        }
        
        .border-left-warning {
            border-left: 0.25rem solid #f6c23e !important;
        }
        
        .text-primary {
            color: #4e73df !important;
        }
        
        .text-success {
            color: #1cc88a !important;
        }
        
        .text-info {
            color: #36b9cc !important;
        }
        
        .text-warning {
            color: #f6c23e !important;
        }
        
        .bg-gradient-primary {
            background: linear-gradient(180deg, #4e73df 10%, #224abe 100%);
        }
        
        .sidebar {
            background: linear-gradient(180deg, #2c3e50 0%, #34495e 100%);
        }
        
        .sidebar .nav-item .nav-link {
            color: rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease;
        }
        
        .sidebar .nav-item .nav-link:hover {
            color: white;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 0.375rem;
            margin: 0 0.5rem;
        }
        
        .topbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
        }

        /* Override de segurança: garantir que a sidebar não ocupe 100% da largura */
        /* Alguns estilos globais podem definir .sidebar com width: 100vw; aqui mantemos o padrão do SB Admin */
        #accordionSidebar.sidebar {
            width: var(--sidebar-width-expanded) !important;
            min-width: var(--sidebar-width-expanded) !important;
        }
        /* O posicionamento será calculado dinamicamente via script para evitar conflitos */
        
        .card-body {
            padding: 1.5rem;
        }
        
        .h4 {
            font-size: 2rem;
            font-weight: 700;
        }
        
        .text-xs {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .table {
            border-radius: 0.75rem;
            overflow: hidden;
        }
        
        .btn {
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-1px);
        }
        
        .content-wrapper {
            background-color: #f8f9fc;
        }
        
        .page-header {
            margin-bottom: 2rem;
        }
        
        .page-header h1 {
            color: #5a5c69;
            font-weight: 400;
            font-size: 1.75rem;
        }
        
        .dropdown-menu {
            border: none;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            border-radius: 0.5rem;
        }
        
        .empty-state {
            padding: 3rem 1rem;
            text-align: center;
            color: #6c757d;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
    </style>
    
    

</head>

<body id="page-top">

    <!-- Page Wrapper -->
    <div id="wrapper">

        <!-- Sidebar -->
        <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

            <!-- Sidebar - Brand -->
            <a class="sidebar-brand d-flex align-items-center justify-content-center" href="#" data-target="dashboard-section">
                <div class="sidebar-brand-icon rotate-n-15">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <div class="sidebar-brand-text mx-3">Sistema <sup>PR7</sup></div>
            </a>

            <!-- Divider -->
            <hr class="sidebar-divider my-0">

            <!-- User Profile Section -->
            <div class="sidebar-profile p-3 text-center">
                <img src="https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_960_720.png" 
                     alt="User Profile" class="rounded-circle mb-2" width="50" height="50">
                <div class="text-white">
                    <h6 class="mb-0 fw-bold">User.Biel</h6>
                    <small class="text-white-50">Admin</small>
                </div>
            </div>

            <!-- Divider -->
            <hr class="sidebar-divider">

            <!-- Nav Item - Dashboard -->
            <li class="nav-item active">
                <a class="nav-link" href="#" data-target="dashboard-section">
                    <i class="fas fa-fw fa-tachometer-alt"></i>
                    <span>Dashboard</span></a>
            </li>

            <!-- Nav Item - Cadastros -->
            <li class="nav-item">
                <a class="nav-link" href="#" data-target="register-section">
                    <i class="fas fa-fw fa-folder-plus"></i>
                    <span>Cadastros</span></a>
            </li>

            <!-- Nav Item - Ocorrências -->
            <li class="nav-item">
                <a class="nav-link" href="#" data-target="section-ocorrencias">
                    <i class="fas fa-fw fa-list-alt"></i>
                    <span>Ocorrências</span></a>
            </li>

            <!-- Nav Item - Patrimonial -->
            <li class="nav-item">
                <a class="nav-link" href="#" data-target="section-patrimonial">
                    <i class="fas fa-fw fa-building"></i>
                    <span>Patrimonial</span></a>
            </li>

            <!-- Nav Item - Veicular -->
            <li class="nav-item">
                <a class="nav-link" href="#" data-target="section-veicular">
                    <i class="fas fa-fw fa-car"></i>
                    <span>Veicular</span></a>
            </li>

            <!-- Nav Item - Meu Perfil -->
            <li class="nav-item">
                <a class="nav-link" href="#" data-target="profile-settings-section">
                    <i class="fas fa-fw fa-user"></i>
                    <span>Meu Perfil</span></a>
            </li>

            <!-- Divider -->
            <hr class="sidebar-divider">

            <!-- Heading -->
            <div class="sidebar-heading">
                Sistema
            </div>

            <!-- Nav Item - Suporte -->
            <li class="nav-item">
                <a class="nav-link" href="#" data-target="support-section">
                    <i class="fas fa-fw fa-question-circle"></i>
                    <span>Suporte</span></a>
            </li>

            <!-- Nav Item - Localização -->
            <li class="nav-item">
                <a class="nav-link" href="#" data-target="location-section">
                    <i class="fas fa-fw fa-map-marker-alt"></i>
                    <span>Localização</span></a>
            </li>

            <!-- Nav Item - Configurações -->
            <li class="nav-item">
                <a class="nav-link" href="#" data-target="system-config-section">
                    <i class="fas fa-fw fa-cog"></i>
                    <span>Configurações</span></a>
            </li>

            <!-- Nav Item - Sobre PR7 -->
            <li class="nav-item">
                <a class="nav-link" href="#" data-target="about-pr7-section">
                    <i class="fas fa-fw fa-info-circle"></i>
                    <span>Sobre a PR7</span></a>
            </li>

            <!-- Divider -->
            <hr class="sidebar-divider d-none d-md-block">

            <!-- Nav Item - Sair -->
            <li class="nav-item">
                <a class="nav-link text-danger" href="#" data-target="logout-section">
                    <i class="fas fa-fw fa-sign-out-alt"></i>
                    <span>Sair</span></a>
            </li>

            <!-- Sidebar Toggler (Sidebar) -->
            <div class="text-center d-none d-md-inline">
                <button class="rounded-circle border-0" id="sidebarToggle"></button>
            </div>

            <!-- Sidebar Message -->
            <div class="sidebar-card d-none d-lg-flex">
                <img class="sidebar-card-illustration mb-2" src="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/svgs/solid/rocket.svg" alt="Sistema PR7" style="width: 60px; height: 60px; filter: invert(1);">
                <p class="text-center mb-2"><strong>Sistema PR7</strong> oferece gerenciamento completo de ocorrências e muito mais!</p>
                <a class="btn btn-success btn-sm" href="#" data-target="about-pr7-section">Saiba Mais!</a>
            </div>

        </ul>
        <!-- End of Sidebar -->

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

            <!-- Main Content -->
            <div id="content">

                <!-- Topbar -->
                <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">

                    <!-- Sidebar Toggle (Topbar) -->
                    <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
                        <i class="fa fa-bars"></i>
                    </button>

                    <!-- Topbar Search -->
                    <form class="d-none d-sm-inline-block form-inline mr-auto ml-md-3 my-2 my-md-0 mw-100 navbar-search">
                        <div class="input-group">
                            <input type="text" class="form-control bg-light border-0 small" placeholder="Buscar ocorrências..."
                                aria-label="Search" aria-describedby="basic-addon2" id="searchInput">
                            <div class="input-group-append">
                                <button class="btn btn-primary" type="button" onclick="searchOccurrences()">
                                    <i class="fas fa-search fa-sm"></i>
                                </button>
                            </div>
                        </div>
                    </form>

                    <!-- Topbar Navbar -->
                    <ul class="navbar-nav ml-auto">
                        <!-- Botão - Novo Cadastro -->
                        <li class="nav-item no-arrow mr-2">
                            <a class="nav-link btn btn-primary btn-sm text-white" href="#" id="btn-open-ocorrencia-modal" role="button" aria-controls="modal-ocorrencia" title="Novo Cadastro">
                                <i class="fas fa-plus fa-fw"></i>
                                <span class="d-none d-lg-inline">Novo Cadastro</span>
                            </a>
                        </li>
                        <!-- Botão - Notificações -->
                        <li class="nav-item no-arrow">
                            <a class="nav-link" href="#" id="btn-show-notifications" role="button" aria-controls="notifications-modal" title="Notificações">
                                <i class="fas fa-bell fa-fw"></i>
                                <span class="d-none d-lg-inline">Notificações</span>
                            </a>
                        </li>

                        <!-- Nav Item - Search Dropdown (Visible Only XS) -->
                        <li class="nav-item dropdown no-arrow d-sm-none">
                            <a class="nav-link dropdown-toggle" href="#" id="searchDropdown" role="button"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="fas fa-search fa-fw"></i>
                            </a>
                            <!-- Dropdown - Messages -->
                            <div class="dropdown-menu dropdown-menu-right p-3 shadow animated--grow-in"
                                aria-labelledby="searchDropdown">
                                <form class="form-inline mr-auto w-100 navbar-search">
                                    <div class="input-group">
                                        <input type="text" class="form-control bg-light border-0 small"
                                            placeholder="Buscar..." aria-label="Search"
                                            aria-describedby="basic-addon2">
                                        <div class="input-group-append">
                                            <button class="btn btn-primary" type="button">
                                                <i class="fas fa-search fa-sm"></i>
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </li>

                        <!-- Nav Item - Alerts -->
                        <li class="nav-item dropdown no-arrow mx-1">
                            <a class="nav-link dropdown-toggle" href="#" id="alertsDropdown" role="button"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="fas fa-bell fa-fw"></i>
                                <!-- Counter - Alerts -->
                                <span class="badge badge-danger badge-counter" id="notification-count">3+</span>
                            </a>
                            <!-- Dropdown - Alerts -->
                            <div class="dropdown-list dropdown-menu dropdown-menu-right shadow animated--grow-in"
                                aria-labelledby="alertsDropdown">
                                <h6 class="dropdown-header">
                                    Central de Alertas
                                </h6>
                                <a class="dropdown-item d-flex align-items-center" href="#">
                                    <div class="mr-3">
                                        <div class="icon-circle bg-primary">
                                            <i class="fas fa-file-alt text-white"></i>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="small text-gray-500">12 de Dezembro, 2023</div>
                                        <span class="font-weight-bold">Nova ocorrência cadastrada!</span>
                                    </div>
                                </a>
                                <a class="dropdown-item d-flex align-items-center" href="#">
                                    <div class="mr-3">
                                        <div class="icon-circle bg-success">
                                            <i class="fas fa-donate text-white"></i>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="small text-gray-500">7 de Dezembro, 2023</div>
                                        Backup realizado com sucesso!
                                    </div>
                                </a>
                                <a class="dropdown-item d-flex align-items-center" href="#">
                                    <div class="mr-3">
                                        <div class="icon-circle bg-warning">
                                            <i class="fas fa-exclamation-triangle text-white"></i>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="small text-gray-500">2 de Dezembro, 2023</div>
                                        Atenção: Sistema será atualizado em breve
                                    </div>
                                </a>
                                <a class="dropdown-item text-center small text-gray-500" href="#">Ver Todos os Alertas</a>
                            </div>
                        </li>

                        <!-- Nav Item - Messages -->
                        <li class="nav-item dropdown no-arrow mx-1">
                            <a class="nav-link dropdown-toggle" href="#" id="messagesDropdown" role="button"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="fas fa-envelope fa-fw"></i>
                                <!-- Counter - Messages -->
                                <span class="badge badge-danger badge-counter">7</span>
                            </a>
                            <!-- Dropdown - Messages -->
                            <div class="dropdown-list dropdown-menu dropdown-menu-right shadow animated--grow-in"
                                aria-labelledby="messagesDropdown">
                                <h6 class="dropdown-header">
                                    Central de Mensagens
                                </h6>
                                <a class="dropdown-item d-flex align-items-center" href="#">
                                    <div class="dropdown-list-image mr-3">
                                        <div class="rounded-circle bg-primary d-flex align-items-center justify-content-center" style="width: 60px; height: 60px; color: white; font-weight: bold;">EF</div>
                                        <div class="status-indicator bg-success"></div>
                                    </div>
                                    <div class="font-weight-bold">
                                        <div class="text-truncate">Olá! Há uma nova atualização disponível para o sistema, gostaria de verificar?</div>
                                        <div class="small text-gray-500">Emily Fowler · 58m</div>
                                    </div>
                                </a>
                                <a class="dropdown-item d-flex align-items-center" href="#">
                                    <div class="dropdown-list-image mr-3">
                                        <div class="rounded-circle bg-info d-flex align-items-center justify-content-center" style="width: 60px; height: 60px; color: white; font-weight: bold;">JC</div>
                                        <div class="status-indicator"></div>
                                    </div>
                                    <div>
                                        <div class="text-truncate">Tenho uma pergunta sobre o relatório do último mês. Você poderia me ajudar?</div>
                                        <div class="small text-gray-500">Jae Chun · 1d</div>
                                    </div>
                                </a>
                                <a class="dropdown-item text-center small text-gray-500" href="#">Ler Mais Mensagens</a>
                            </div>
                        </li>

                        <div class="topbar-divider d-none d-sm-block"></div>

                        <!-- Nav Item - User Information -->
                        <li class="nav-item dropdown no-arrow">
                            <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="mr-2 d-none d-lg-inline text-gray-600 small">Gabriel Silva</span>
                                <div class="img-profile rounded-circle bg-secondary d-flex align-items-center justify-content-center" style="width: 60px; height: 60px; color: white; font-weight: bold;">GS</div>
                            </a>
                            <!-- Dropdown - User Information -->
                            <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in"
                                aria-labelledby="userDropdown">
                                <a class="dropdown-item" href="#" data-target="profile-settings-section">
                                    <i class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Perfil
                                </a>
                                <a class="dropdown-item" href="#" data-target="system-config-section">
                                    <i class="fas fa-cogs fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Configurações
                                </a>
                                <a class="dropdown-item" href="#">
                                    <i class="fas fa-list fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Log de Atividades
                                </a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="#" data-toggle="modal" data-target="#logoutModal">
                                    <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
                                    Sair
                                </a>
                            </div>
                        </li>

                    </ul>

                </nav>
                <!-- End of Topbar -->

                <!-- Begin Page Content -->
                <div class="container-fluid">

                    <!-- Dashboard Section -->
                    <div id="dashboard-section" class="content-section active">
                        <!-- Page Header -->
                        <div class="d-sm-flex align-items-center justify-content-between mb-4">
                            <div>
                                <h1 class="h3 mb-0 text-gray-800">
                                    <i class="fas fa-tachometer-alt mr-2 text-primary"></i>Dashboard
                                </h1>
                                <p class="mb-0 text-gray-600">Sistema de Gestão de Ocorrências</p>
                            </div>
                            <div class="btn-group" role="group">
                                <a href="#" class="btn btn-primary shadow-sm mr-2" data-toggle="modal" data-target="#cadastroModal">
                                    <i class="fas fa-plus mr-2"></i>Nova Ocorrência
                                </a>
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn btn-outline-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <i class="fas fa-cog mr-1"></i>Opções
                                    </button>
                                    <div class="dropdown-menu dropdown-menu-right">
                                        <a class="dropdown-item" href="#" onclick="exportMetrics()">
                                            <i class="fas fa-download mr-2"></i>Exportar Dados
                                        </a>
                                        <a class="dropdown-item" href="#" onclick="showMetricsDashboard()">
                                            <i class="fas fa-chart-bar mr-2"></i>Ver Métricas
                                        </a>
                                        <div class="dropdown-divider"></div>
                                        <a class="dropdown-item text-danger" href="#" onclick="resetMetrics()">
                                            <i class="fas fa-trash mr-2"></i>Limpar Dados
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                    <!-- Content Row - Métricas -->
                    <div class="row">

                        <!-- Ocorrências Pendentes Card -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-warning shadow h-100 py-2 hover-shadow">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                                Ocorrências Pendentes</div>
                                            <div class="h4 mb-0 font-weight-bold text-gray-800" id="count-pending">0</div>
                                            <div class="text-xs text-muted mt-1">Aguardando resolução</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-exclamation-triangle fa-2x text-warning"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Ocorrências Finalizadas Card -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-success shadow h-100 py-2 hover-shadow">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                                Ocorrências Finalizadas</div>
                                            <div class="h4 mb-0 font-weight-bold text-gray-800" id="count-finalized">0</div>
                                            <div class="text-xs text-muted mt-1">Casos resolvidos</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-check-circle fa-2x text-success"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Total de Ocorrências Card -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-primary shadow h-100 py-2 hover-shadow">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                                Total de Ocorrências</div>
                                            <div class="h4 mb-0 font-weight-bold text-gray-800" id="count-total">0</div>
                                            <div class="text-xs text-muted mt-1">Registros no sistema</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-database fa-2x text-primary"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Patrimônios Cadastrados Card -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-info shadow h-100 py-2 hover-shadow">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                                Patrimônios Cadastrados</div>
                                            <div class="h4 mb-0 font-weight-bold text-gray-800" id="count-patrimonial">0</div>
                                            <div class="text-xs text-muted mt-1">Bens registrados</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-building fa-2x text-info"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- Content Row - Métricas Adicionais -->
                    <div class="row">

                        <!-- Veículos Cadastrados -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-secondary shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-secondary text-uppercase mb-1">
                                                Veículos Cadastrados</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="count-veicular">0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-car fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Total Cadastrado -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-dark shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-dark text-uppercase mb-1">
                                                Total Cadastrado</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="count-total-registered">0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-database fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Cadastros Nesta Sessão -->
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-light shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-muted text-uppercase mb-1">
                                                Cadastros Nesta Sessão</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="count-session-registered">0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-clock fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- Quick Stats Row -->
                    <div class="row mb-4">
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-info shadow h-100 py-2 hover-shadow">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                                Média Diária
                                            </div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="media-diaria">0</div>
                                            <div class="text-xs text-muted">ocorrências por dia</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-chart-line fa-2x text-info"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-success shadow h-100 py-2 hover-shadow">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                                Taxa de Resolução
                                            </div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="taxa-resolucao">0%</div>
                                            <div class="text-xs text-muted">casos resolvidos</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-percentage fa-2x text-success"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-warning shadow h-100 py-2 hover-shadow">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                                Tempo Médio
                                            </div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="tempo-medio">0h</div>
                                            <div class="text-xs text-muted">para resolução</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-clock fa-2x text-warning"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-primary shadow h-100 py-2 hover-shadow">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                                Última Atualização
                                            </div>
                                            <div class="h6 mb-0 font-weight-bold text-gray-800" id="ultima-atualizacao">Agora</div>
                                            <div class="text-xs text-muted">dados em tempo real</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-sync-alt fa-2x text-primary"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Content Row -->
                    <div class="row">

                        <!-- Area Chart -->
                        <div class="col-xl-8 col-lg-7">
                            <div class="card shadow mb-4">
                                <!-- Card Header - Dropdown -->
                                <div
                                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">Visão Geral de Ocorrências</h6>
                                    <div class="dropdown no-arrow">
                                        <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
                                            aria-labelledby="dropdownMenuLink">
                                            <div class="dropdown-header">Opções do Gráfico:</div>
                                            <a class="dropdown-item" href="#">Exportar Dados</a>
                                            <a class="dropdown-item" href="#">Atualizar</a>
                                            <div class="dropdown-divider"></div>
                                            <a class="dropdown-item" href="#">Configurações</a>
                                        </div>
                                    </div>
                                </div>
                                <!-- Card Body -->
                                <div class="card-body">
                                    <div class="chart-area">
                                        <canvas id="myAreaChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Pie Chart -->
                        <div class="col-xl-4 col-lg-5">
                            <div class="card shadow mb-4">
                                <!-- Card Header - Dropdown -->
                                <div
                                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">Distribuição por Tipo</h6>
                                    <div class="dropdown no-arrow">
                                        <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
                                            aria-labelledby="dropdownMenuLink">
                                            <div class="dropdown-header">Opções do Gráfico:</div>
                                            <a class="dropdown-item" href="#">Exportar Dados</a>
                                            <a class="dropdown-item" href="#">Atualizar</a>
                                            <div class="dropdown-divider"></div>
                                            <a class="dropdown-item" href="#">Configurações</a>
                                        </div>
                                    </div>
                                </div>
                                <!-- Card Body -->
                                <div class="card-body">
                                    <div class="chart-pie pt-4 pb-2">
                                        <canvas id="myPieChart"></canvas>
                                    </div>
                                    <div class="mt-4 text-center small">
                                        <span class="mr-2">
                                            <i class="fas fa-circle text-primary"></i> Patrimonial
                                        </span>
                                        <span class="mr-2">
                                            <i class="fas fa-circle text-success"></i> Veicular
                                        </span>
                                        <span class="mr-2">
                                            <i class="fas fa-circle text-info"></i> Outros
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Content Row -->
                    <div class="row">

                        <!-- Tabela de Ocorrências -->
                        <div class="col-lg-12">
                            <div class="card shadow mb-4 hover-shadow">
                                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">
                                        <i class="fas fa-table mr-2"></i>Ocorrências Registradas
                                    </h6>
                                    <div class="dropdown no-arrow">
                                        <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
                                            aria-labelledby="dropdownMenuLink">
                                            <div class="dropdown-header">Opções:</div>
                                            <a class="dropdown-item" href="#" onclick="exportData()">Exportar Dados</a>
                                            <a class="dropdown-item" href="#" onclick="clearAllData()">Limpar Dados</a>
                                            <a class="dropdown-item" href="#" onclick="showMetricsDashboard()">Ver Métricas</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover" id="dataTable" width="100%" cellspacing="0">
                                            <thead class="thead-light">
                                                <tr id="table-header">
                                                    <th class="border-0">
                                                        <i class="fas fa-hashtag mr-1"></i>ID
                                                    </th>
                                                    <th class="border-0">
                                                        <i class="fas fa-file-alt mr-1"></i>Título
                                                    </th>
                                                    <th class="border-0">
                                                        <i class="fas fa-tag mr-1"></i>Tipo
                                                    </th>
                                                    <th class="border-0">
                                                        <i class="fas fa-info-circle mr-1"></i>Status
                                                    </th>
                                                    <th class="border-0">
                                                        <i class="fas fa-calendar mr-1"></i>Data
                                                    </th>
                                                    <th class="border-0">
                                                        <i class="fas fa-cogs mr-1"></i>Ações
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody id="table-body">
                                                <!-- Dados serão inseridos dinamicamente -->
                                                <tr class="text-center text-muted">
                                                    <td colspan="6" class="py-4">
                                                        <i class="fas fa-inbox fa-2x mb-2 d-block"></i>
                                                        <span>Nenhuma ocorrência cadastrada ainda</span>
                                                        <br>
                                                        <small>Clique em "Novo Cadastro" para começar</small>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- TODO/Tasks Section -->
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="card shadow mb-4">
                                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">
                                        <i class="fas fa-clipboard-list mr-2"></i>Lista de Tarefas
                                    </h6>
                                    <div class="dropdown no-arrow">
                                        <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
                                            aria-labelledby="dropdownMenuLink">
                                            <div class="dropdown-header">Opções:</div>
                                            <a class="dropdown-item" href="#" onclick="addNewTask()">Nova Tarefa</a>
                                            <a class="dropdown-item" href="#" onclick="clearCompletedTasks()">Limpar Concluídas</a>
                                            <div class="dropdown-divider"></div>
                                            <a class="dropdown-item" href="#" onclick="exportTasks()">Exportar Lista</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="new-task-input" placeholder="Digite uma nova tarefa...">
                                            <div class="input-group-append">
                                                <button class="btn btn-primary" type="button" onclick="addTask()">
                                                    <i class="fas fa-plus"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="tasks-container">
                                        <div class="text-center text-muted py-3">
                                            <i class="fas fa-tasks fa-2x mb-2 d-block"></i>
                                            <span>Nenhuma tarefa adicionada</span>
                                            <br>
                                            <small>Digite uma tarefa acima para começar</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-6">
                            <div class="card shadow mb-4">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-success">
                                        <i class="fas fa-chart-pie mr-2"></i>Progresso das Tarefas
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <span class="text-xs font-weight-bold text-success text-uppercase">Progresso Geral</span>
                                            <span class="text-xs font-weight-bold" id="progress-percentage">0%</span>
                                        </div>
                                        <div class="progress">
                                            <div class="progress-bar bg-success" role="progressbar" id="progress-bar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                    </div>
                                    <div class="row text-center">
                                        <div class="col">
                                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Total</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="total-tasks">0</div>
                                        </div>
                                        <div class="col">
                                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">Pendentes</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="pending-tasks">0</div>
                                        </div>
                                        <div class="col">
                                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Concluídas</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="completed-tasks">0</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End TODO/Tasks Section -->

                    </div> <!-- /#dashboard-section -->
                    <!-- End Dashboard Section -->

                    <!-- Register Section -->
                    <div id="register-section" class="content-section">
                        <h2><i class="fas fa-folder-plus mr-2"></i>Cadastro de Ocorrências</h2>
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="card shadow mb-4">
                                    <div class="card-header py-3">
                                        <h6 class="m-0 font-weight-bold text-primary">Tipos de Cadastro</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-4 mb-3">
                                                <div class="card border-left-primary h-100">
                                                    <div class="card-body text-center">
                                                        <i class="fas fa-exclamation-triangle fa-3x text-primary mb-3"></i>
                                                        <h5>Ocorrência Geral</h5>
                                                        <p class="text-muted">Registrar ocorrências gerais do sistema</p>
                                                        <button class="btn btn-primary" onclick="openModal('ocorrencia')">Cadastrar</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <div class="card border-left-success h-100">
                                                    <div class="card-body text-center">
                                                        <i class="fas fa-building fa-3x text-success mb-3"></i>
                                                        <h5>Patrimonial</h5>
                                                        <p class="text-muted">Cadastro de bens patrimoniais</p>
                                                        <button class="btn btn-success" onclick="openModal('patrimonial')">Cadastrar</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <div class="card border-left-info h-100">
                                                    <div class="card-body text-center">
                                                        <i class="fas fa-car fa-3x text-info mb-3"></i>
                                                        <h5>Veicular</h5>
                                                        <p class="text-muted">Cadastro de veículos e frotas</p>
                                                        <button class="btn btn-info" onclick="openModal('veicular')">Cadastrar</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Formulário de Cadastro -->
                                        <!-- Bloco de mapa duplicado desativado para evitar conflitos -->
                                        <div class="row mt-4" style="display:none">
                                            <div class="col-lg-12">
                                                <div class="card shadow">
                                                    <div class="card-header py-3">
                                                        <h6 class="m-0 font-weight-bold text-primary">Formulário de Cadastro</h6>
                                                    </div>
                                                    <div class="card-body">
                                                        <form id="cadastroForm">
                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label for="tipoOcorrencia">Tipo de Ocorrência:</label>
                                                                        <select class="form-control" id="tipoOcorrencia" required>
                                                                            <option value="">Selecione o tipo</option>
                                                                            <option value="geral">Ocorrência Geral</option>
                                                                            <option value="patrimonial">Patrimonial</option>
                                                                            <option value="veicular">Veicular</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label for="prioridade">Prioridade:</label>
                                                                        <select class="form-control" id="prioridade" required>
                                                                            <option value="">Selecione a prioridade</option>
                                                                            <option value="baixa">Baixa</option>
                                                                            <option value="media">Média</option>
                                                                            <option value="alta">Alta</option>
                                                                            <option value="critica">Crítica</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="form-group">
                                                                <label for="titulo">Título:</label>
                                                                <input type="text" class="form-control" id="titulo" placeholder="Digite o título da ocorrência" required>
                                                            </div>
                                                            <div class="form-group">
                                                                <label for="descricao">Descrição:</label>
                                                                <textarea class="form-control" id="descricao" rows="4" placeholder="Descreva detalhadamente a ocorrência" required></textarea>
                                                            </div>
                                                            <!-- Campos específicos para Veicular -->
                                                            <div id="camposVeicular" class="campos-especificos" style="display: none;">
                                                                <div class="row">
                                                                    <div class="col-md-4">
                                                                        <div class="form-group">
                                                                            <label for="marca">Marca:</label>
                                                                            <input type="text" class="form-control" id="marca" placeholder="Ex: Fiat, Ford, Chevrolet">
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-4">
                                                                        <div class="form-group">
                                                                            <label for="modelo">Modelo:</label>
                                                                            <input type="text" class="form-control" id="modelo" placeholder="Ex: Uno, Fiesta, Onix">
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-4">
                                                                        <div class="form-group">
                                                                            <label for="placa">Placa:</label>
                                                                            <input type="text" class="form-control" id="placa" placeholder="ABC-1234" maxlength="8">
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="row">
                                                                    <div class="col-md-4">
                                                                        <div class="form-group">
                                                                            <label for="ano">Ano:</label>
                                                                            <input type="number" class="form-control" id="ano" placeholder="2020" min="1900" max="2030">
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-4">
                                                                        <div class="form-group">
                                                                            <label for="cor">Cor:</label>
                                                                            <input type="text" class="form-control" id="cor" placeholder="Ex: Branco, Preto, Prata">
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-4">
                                                                        <div class="form-group">
                                                                            <label for="chassi">Chassi:</label>
                                                                            <input type="text" class="form-control" id="chassi" placeholder="Número do chassi">
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <!-- Campos específicos para Patrimonial -->
                                                            <div id="camposPatrimonial" class="campos-especificos" style="display: none;">
                                                                <div class="row">
                                                                    <div class="col-md-4">
                                                                        <div class="form-group">
                                                                            <label for="numeroPatrimonio">Número do Patrimônio:</label>
                                                                            <input type="text" class="form-control" id="numeroPatrimonio" placeholder="Ex: PAT001">
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-4">
                                                                        <div class="form-group">
                                                                            <label for="categoria">Categoria:</label>
                                                                            <select class="form-control" id="categoria">
                                                                                <option value="">Selecione a categoria</option>
                                                                                <option value="mobiliario">Mobiliário</option>
                                                                                <option value="equipamento">Equipamento</option>
                                                                                <option value="eletronico">Eletrônico</option>
                                                                                <option value="informatica">Informática</option>
                                                                                <option value="outros">Outros</option>
                                                                            </select>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-4">
                                                                        <div class="form-group">
                                                                            <label for="valor">Valor (R$):</label>
                                                                            <input type="number" class="form-control" id="valor" placeholder="0,00" step="0.01" min="0">
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="row">
                                                                    <div class="col-md-6">
                                                                        <div class="form-group">
                                                                            <label for="fornecedor">Fornecedor:</label>
                                                                            <input type="text" class="form-control" id="fornecedor" placeholder="Nome do fornecedor">
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-6">
                                                                        <div class="form-group">
                                                                            <label for="dataAquisicao">Data de Aquisição:</label>
                                                                            <input type="date" class="form-control" id="dataAquisicao">
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <div class="row">
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label for="local">Local:</label>
                                                                        <div class="input-group">
                                                                            <input type="text" class="form-control" id="local" placeholder="Ex: Sala 101, Bloco A" required>
                                                                            <div class="input-group-append">
                                                                                <button type="button" class="btn btn-outline-primary" id="btnCapturarGPS" title="Capturar localização atual">
                                                                                    <i class="fas fa-map-marker-alt"></i> GPS
                                                                                </button>
                                                                            </div>
                                                                        </div>
                                                                        <small class="form-text text-muted">Digite o endereço ou clique em GPS para capturar sua localização atual</small>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6">
                                                                    <div class="form-group">
                                                                        <label for="responsavel">Responsável:</label>
                                                                        <input type="text" class="form-control" id="responsavel" placeholder="Nome do responsável" required>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="text-right">
                                                                <button type="button" class="btn btn-secondary mr-2" onclick="limparFormulario()">Cancelar</button>
                                                                <button type="submit" class="btn btn-primary">Cadastrar Ocorrência</button>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Grid Avançado de Ocorrências -->
                                        <div class="row mt-4">
                                            <div class="col-lg-12">
                                                <div class="card shadow">
                                                    <div class="card-header py-3">
                                                        <div class="d-flex justify-content-between align-items-center">
                                                            <h6 class="m-0 font-weight-bold text-primary">Grid Avançado de Ocorrências</h6>
                                                            <div class="btn-group" role="group">
                                                                <button class="btn btn-sm btn-outline-success" onclick="importarOcorrencias()">
                                                                    <i class="fas fa-upload"></i> Importar
                                                                </button>
                                                                <button class="btn btn-sm btn-outline-primary" onclick="exportarOcorrencias()">
                                                                    <i class="fas fa-download"></i> Exportar
                                                                </button>
                                                                <button class="btn btn-sm btn-outline-info" onclick="gerarRelatorio()">
                                                                    <i class="fas fa-chart-bar"></i> Relatório
                                                                </button>
                                                                <button class="btn btn-sm btn-outline-warning" onclick="sincronizarMapa()">
                                                                    <i class="fas fa-sync"></i> Sincronizar Mapa
                                                                </button>
                                                                <button class="btn btn-sm btn-outline-danger" onclick="limparTodasOcorrencias()">
                                                                    <i class="fas fa-trash"></i> Limpar Todas
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card-body">
                                                        <!-- Controles Avançados de Filtro e Busca -->
                                                        <div class="row mb-3">
                                                            <div class="col-md-3">
                                                                <div class="input-group">
                                                                    <div class="input-group-prepend">
                                                                        <span class="input-group-text"><i class="fas fa-search"></i></span>
                                                                    </div>
                                                                    <input type="text" class="form-control" id="searchInput" placeholder="Busca avançada..." onkeyup="filtrarOcorrenciasAvancado()">
                                                                </div>
                                                            </div>
                                                            <div class="col-md-2">
                                                                <select class="form-control" id="tipoFilter" onchange="filtrarOcorrenciasAvancado()">
                                                                    <option value="">Todos os Tipos</option>
                                                                    <option value="geral">Geral</option>
                                                                    <option value="patrimonial">Patrimonial</option>
                                                                    <option value="veicular">Veicular</option>
                                                                </select>
                                                            </div>
                                                            <div class="col-md-2">
                                                                <select class="form-control" id="prioridadeFilter" onchange="filtrarOcorrenciasAvancado()">
                                                                    <option value="">Prioridades</option>
                                                                    <option value="baixa">Baixa</option>
                                                                    <option value="media">Média</option>
                                                                    <option value="alta">Alta</option>
                                                                    <option value="critica">Crítica</option>
                                                                </select>
                                                            </div>
                                                            <div class="col-md-2">
                                                                <select class="form-control" id="statusFilter" onchange="filtrarOcorrenciasAvancado()">
                                                                    <option value="">Status</option>
                                                                    <option value="pendente">Pendente</option>
                                                                    <option value="em-andamento">Em Andamento</option>
                                                                    <option value="resolvida">Resolvida</option>
                                                                    <option value="cancelada">Cancelada</option>
                                                                </select>
                                                            </div>
                                                            <div class="col-md-2">
                                                                <input type="date" class="form-control" id="dataFilter" onchange="filtrarOcorrenciasAvancado()" title="Filtrar por data">
                                                            </div>
                                                            <div class="col-md-1">
                                                                <button class="btn btn-outline-secondary btn-block" onclick="limparFiltrosAvancados()" title="Limpar todos os filtros">
                                                                    <i class="fas fa-times"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                        
                                                        <!-- Controles de Visualização -->
                                                        <div class="row mb-3">
                                                            <div class="col-md-6">
                                                                <div class="btn-group btn-group-sm" role="group">
                                                                    <button type="button" class="btn btn-outline-primary active" onclick="alternarVisualizacao('tabela')">
                                                                        <i class="fas fa-table"></i> Tabela
                                                                    </button>
                                                                    <button type="button" class="btn btn-outline-primary" onclick="alternarVisualizacao('cards')">
                                                                        <i class="fas fa-th-large"></i> Cards
                                                                    </button>
                                                                    <button type="button" class="btn btn-outline-primary" onclick="alternarVisualizacao('lista')">
                                                                        <i class="fas fa-list"></i> Lista
                                                                    </button>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-6 text-right">
                                                                <div class="d-inline-flex align-items-center">
                                                                    <span class="text-muted mr-2">Itens por página:</span>
                                                                    <select class="form-control form-control-sm" id="itensPorPagina" onchange="alterarItensPorPagina()" style="width: auto;">
                                                                        <option value="10">10</option>
                                                                        <option value="25" selected>25</option>
                                                                        <option value="50">50</option>
                                                                        <option value="100">100</option>
                                                                    </select>
                                                                    <span class="text-muted ml-3" id="contadorItens">0 itens</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
                                                        <div class="table-responsive">
                                                            <table class="table table-bordered" id="ocorrenciasTable">
                                                                <thead>
                                                                    <tr>
                                                                        <th>ID</th>
                                                                        <th>Tipo</th>
                                                                        <th>Título</th>
                                                                        <th>Detalhes Específicos</th>
                                                                        <th>Prioridade</th>
                                                                        <th>Local</th>
                                                                        <th>Responsável</th>
                                                                        <th>Status</th>
                                                                        <th>Data</th>
                                                                        <th>Ações</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody id="ocorrenciasTableBody">
                                                                    <tr id="noOccurrencesRow">
                                                                        <td colspan="10" class="text-center text-muted">
                                                                            <i class="fas fa-inbox fa-2x mb-2"></i><br>
                                                                            Nenhuma ocorrência cadastrada ainda
                                                                        </td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Mapa Interativo de Ocorrências (oculto para evitar duplicação) -->
                                        <div class="row mt-4" style="display: none;">
                                            <div class="col-lg-12">
                                                <div class="card shadow">
                                                    <div class="card-header py-3">
                                                        <div class="d-flex justify-content-between align-items-center">
                                                            <h6 class="m-0 font-weight-bold text-primary">Mapa Interativo de Ocorrências</h6>
                                                            <div class="btn-group" role="group">
                                                                <button class="btn btn-sm btn-outline-primary" onclick="centralizarMapa()">
                                                                    <i class="fas fa-crosshairs"></i> Centralizar
                                                                </button>
                                                                <button class="btn btn-sm btn-outline-success" onclick="atualizarMapa()">
                                                                    <i class="fas fa-sync-alt"></i> Atualizar
                                                                </button>
                                                                <button class="btn btn-sm btn-outline-info" onclick="alternarCamadas()">
                                                                    <i class="fas fa-layer-group"></i> Camadas
                                                                </button>
                                                                <button class="btn btn-sm btn-outline-warning" onclick="modoCalor()">
                                                                    <i class="fas fa-fire"></i> Mapa de Calor
                                                                </button>
                                                                <button class="btn btn-sm btn-outline-secondary" onclick="exportarMapa()">
                                                                    <i class="fas fa-camera"></i> Capturar
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="card-body p-0">
                                                        <!-- Controles do Mapa -->
                                                        <div class="p-3 border-bottom bg-light">
                                                            <div class="row align-items-center">
                                                                <div class="col-md-3">
                                                                    <div class="input-group input-group-sm">
                                                                        <div class="input-group-prepend">
                                                                            <span class="input-group-text"><i class="fas fa-map-marker-alt"></i></span>
                                                                        </div>
                                                                        <input type="text" class="form-control" id="enderecoInput" placeholder="Buscar endereço..." onkeypress="buscarEndereco(event)">
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <select class="form-control form-control-sm" id="tipoMapaFilter" onchange="filtrarMarcadores()">
                                                                        <option value="">Todos os Tipos</option>
                                                                        <option value="geral">Geral</option>
                                                                        <option value="patrimonial">Patrimonial</option>
                                                                        <option value="veicular">Veicular</option>
                                                                    </select>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <select class="form-control form-control-sm" id="statusMapaFilter" onchange="filtrarMarcadores()">
                                                                        <option value="">Todos os Status</option>
                                                                        <option value="pendente">Pendente</option>
                                                                        <option value="em-andamento">Em Andamento</option>
                                                                        <option value="resolvida">Resolvida</option>
                                                                    </select>
                                                                </div>
                                                                <div class="col-md-2">
                                                                    <div class="form-check form-check-inline">
                                                                        <input class="form-check-input" type="checkbox" id="mostrarRaio" onchange="alternarRaio()">
                                                                        <label class="form-check-label" for="mostrarRaio">Raio de Ação</label>
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-3">
                                                                    <div class="d-flex align-items-center">
                                                                        <span class="text-muted mr-2">Zoom:</span>
                                                                        <input type="range" class="form-control-range" id="zoomRange" min="1" max="20" value="13" onchange="alterarZoom(this.value)">
                                                                        <span class="text-muted ml-2" id="zoomValue">13</span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
                                                        <!-- Área do Mapa -->
                                                        <div class="position-relative">
                                                            <!-- Removido contêiner duplicado de mapa local para evitar conflito de IDs -->
                                                            <div id="map-local-container-removido" style="display:none"></div>
                                                            </div>
                                                            
                                                            <!-- Legenda do Mapa -->
                                                            <div class="position-absolute" style="top: 10px; right: 10px; z-index: 1000;">
                                                                <div class="card" style="min-width: 200px;">
                                                                    <div class="card-header py-2">
                                                                        <h6 class="m-0 font-weight-bold text-dark">Legenda</h6>
                                                                    </div>
                                                                    <div class="card-body py-2">
                                                                        <div class="d-flex align-items-center mb-1">
                                                                            <span class="badge badge-danger mr-2">●</span>
                                                                            <small>Crítica</small>
                                                                        </div>
                                                                        <div class="d-flex align-items-center mb-1">
                                                                            <span class="badge badge-warning mr-2">●</span>
                                                                            <small>Alta</small>
                                                                        </div>
                                                                        <div class="d-flex align-items-center mb-1">
                                                                            <span class="badge badge-info mr-2">●</span>
                                                                            <small>Média</small>
                                                                        </div>
                                                                        <div class="d-flex align-items-center">
                                                                            <span class="badge badge-success mr-2">●</span>
                                                                            <small>Baixa</small>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            
                                                            <!-- Estatísticas do Mapa -->
                                                            <div class="position-absolute" style="bottom: 10px; left: 10px; z-index: 1000;">
                                                                <div class="card">
                                                                    <div class="card-body py-2 px-3">
                                                                        <div class="d-flex align-items-center">
                                                                            <i class="fas fa-map-marker-alt text-primary mr-2"></i>
                                                                            <span class="text-muted">Total de marcadores: </span>
                                                                            <strong id="totalMarcadores" class="ml-1">0</strong>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
                                                        <div class="p-3 border-top bg-light">
                                                            <div class="d-flex justify-content-between align-items-center">
                                                                <small class="text-muted">
                                                                    <i class="fas fa-info-circle mr-1"></i>
                                                                    Clique nos marcadores para ver detalhes das ocorrências
                                                                </small>
                                                                <div class="btn-group btn-group-sm" role="group">
                                                                    <button class="btn btn-outline-primary" onclick="verTodasOcorrencias()">
                                                                        <i class="fas fa-eye"></i> Ver Todas
                                                                    </button>
                                                                    <button class="btn btn-outline-secondary" onclick="ocultarMarcadores()">
                                                                        <i class="fas fa-eye-slash"></i> Ocultar
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End Register Section -->

                    <!-- Navigation Buttons for Sections -->
                    <div id="types-nav" class="mb-4 hidden">
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-outline-primary tipo-btn" data-tipo="ocorrencias">
                                <i class="fas fa-list-alt mr-2"></i>Ocorrências
                            </button>
                            <button type="button" class="btn btn-outline-success tipo-btn" data-tipo="patrimonial">
                                <i class="fas fa-building mr-2"></i>Patrimonial
                            </button>
                            <button type="button" class="btn btn-outline-info tipo-btn" data-tipo="veicular">
                                <i class="fas fa-car mr-2"></i>Veicular
                            </button>
                        </div>
                    </div>

                    <!-- Occurrences Section -->
                    <div id="section-ocorrencias" class="content-section">
                        <h2><i class="fas fa-list-alt mr-2"></i>Cadastros de Ocorrências</h2>
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="card shadow mb-4">
                                    <div class="card-header py-3">
                                        <h6 class="m-0 font-weight-bold text-primary">Grid de Ocorrências</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table id="grid-ocorrencias" class="table table-bordered table-hover">
                                                <thead class="thead-light">
                                                    <tr>
                                                        <th>ID</th>
                                                        <th>Título</th>
                                                        <th>Tipo</th>
                                                        <th>Subtipo</th>
                                                        <th>Status</th>
                                                        <th>Localização</th>
                                                        <th>Data</th>
                                                        <th>Ações</th>
                                                    </tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Mapa das Ocorrências -->
                                <div class="card shadow mb-4">
                                    <div class="card-header py-3">
                                        <h6 class="m-0 font-weight-bold text-primary"><i class="fas fa-map-marker-alt mr-2"></i>Mapa das Ocorrências</h6>
                                    </div>
                                    <div class="card-body p-0">
                                        <!-- Controles do Mapa de Ocorrências -->
                                        <div class="p-3 border-bottom bg-light mb-2">
                                            <div class="row align-items-center">
                                                <div class="col-12 col-sm-6 col-md-6 col-lg-4 mb-2">
                                                    <div class="input-group input-group-sm">
                                                        <div class="input-group-prepend">
                                                            <span class="input-group-text"><i class="fas fa-map-marker-alt"></i></span>
                                                        </div>
                                                        <input type="text" class="form-control" id="enderecoInputOcorr" placeholder="Buscar endereço..." onkeypress="buscarEnderecoOcorrencias(event)">
                                                    </div>
                                                </div>
                                                <div class="col-6 col-sm-6 col-md-3 col-lg-2 mb-2">
                                                    <select class="form-control form-control-sm" id="tipoMapaFilterOcorr" onchange="filtrarMarcadoresOcorrencias()">
                                                        <option value="">Todos os Tipos</option>
                                                        <option value="geral">Geral</option>
                                                        <option value="patrimonial">Patrimonial</option>
                                                        <option value="veicular">Veicular</option>
                                                    </select>
                                                </div>
                                                <div class="col-6 col-sm-6 col-md-3 col-lg-2 mb-2">
                                                    <select class="form-control form-control-sm" id="statusMapaFilterOcorr" onchange="filtrarMarcadoresOcorrencias()">
                                                        <option value="">Todos os Status</option>
                                                        <option value="pendente">Pendente</option>
                                                        <option value="em-andamento">Em Andamento</option>
                                                        <option value="resolvida">Resolvida</option>
                                                    </select>
                                                </div>
                                                <div class="col-6 col-sm-6 col-md-3 col-lg-2 mb-2">
                                                    <div class="form-check form-check-inline">
                                                        <input class="form-check-input" type="checkbox" id="mostrarRaioOcorr" onchange="alternarRaioOcorrencias()">
                                                        <label class="form-check-label" for="mostrarRaioOcorr">Raio de Ação</label>
                                                    </div>
                                                </div>
                                                <div class="col-6 col-sm-6 col-md-3 col-lg-2 mb-2">
                                                    <div class="d-flex align-items-center w-100">
                                                        <span class="text-muted mr-2">Zoom:</span>
                                                        <input type="range" class="form-control-range w-100" id="zoomRangeOcorr" min="1" max="20" value="10" onchange="alterarZoomOcorrencias(this.value)">
                                                        <span class="text-muted ml-2" id="zoomValueOcorr">10</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Área do Mapa de Ocorrências -->
                                        <div class="position-relative">
                                            <div id="map-ocorrencias"></div>

                                            <!-- Legenda -->
                                            <div class="position-absolute" style="top: 10px; right: 10px; z-index: 1000;">
                                                <div class="card" style="min-width: 200px;">
                                                    <div class="card-header py-2">
                                                        <h6 class="m-0 font-weight-bold text-dark">Legenda</h6>
                                                    </div>
                                                    <div class="card-body py-2">
                                                        <div class="d-flex align-items-center mb-1">
                                                            <span class="badge badge-danger mr-2">●</span>
                                                            <small>Crítica</small>
                                                        </div>
                                                        <div class="d-flex align-items-center mb-1">
                                                            <span class="badge badge-warning mr-2">●</span>
                                                            <small>Alta</small>
                                                        </div>
                                                        <div class="d-flex align-items-center mb-1">
                                                            <span class="badge badge-info mr-2">●</span>
                                                            <small>Média</small>
                                                        </div>
                                                        <div class="d-flex align-items-center">
                                                            <span class="badge badge-success mr-2">●</span>
                                                            <small>Baixa</small>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Estatísticas do Mapa -->
                                            <div class="position-absolute" style="bottom: 10px; left: 10px; z-index: 1000;">
                                                <div class="card">
                                                    <div class="card-body py-2 px-3">
                                                        <div class="d-flex align-items-center">
                                                            <i class="fas fa-map-marker-alt text-primary mr-2"></i>
                                                            <span class="text-muted">Total de marcadores: </span>
                                                            <strong id="totalMarcadoresOcorr" class="ml-1">0</strong>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="p-3 border-top bg-light">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <small class="text-muted">
                                                    <i class="fas fa-info-circle mr-1"></i>
                                                    Clique nos marcadores para ver detalhes das ocorrências
                                                </small>
                                                <div class="btn-group btn-group-sm" role="group">
                                                    <button class="btn btn-outline-primary" onclick="verTodasMarcadoresOcorrencias()">
                                                        <i class="fas fa-eye"></i> Ver Todas
                                                    </button>
                                                    <button class="btn btn-outline-secondary" onclick="ocultarMarcadoresOcorrencias()">
                                                        <i class="fas fa-eye-slash"></i> Ocultar
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End Occurrences Section -->

                    <!-- Patrimonial Section -->
                    <div id="section-patrimonial" class="content-section">
                        <h2><i class="fas fa-building mr-2"></i>Cadastros Patrimoniais</h2>
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="card shadow mb-4">
                                    <div class="card-header py-3">
                                        <h6 class="m-0 font-weight-bold text-success">Grid Patrimonial</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table id="grid-patrimonial" class="table table-bordered table-hover">
                                                <thead class="thead-light">
                                                    <tr>
                                                        <th>ID</th>
                                                        <th>Nome</th>
                                                        <th>Tipo</th>
                                                        <th>Localização</th>
                                                        <th>Ações</th>
                                                    </tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End Patrimonial Section -->

                    <!-- Veicular Section -->
                    <div id="section-veicular" class="content-section">
                        <h2><i class="fas fa-car mr-2"></i>Cadastros Veiculares</h2>
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="card shadow mb-4">
                                    <div class="card-header py-3">
                                        <h6 class="m-0 font-weight-bold text-info">Grid Veicular</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table id="grid-veicular" class="table table-bordered table-hover">
                                                <thead class="thead-light">
                                                    <tr>
                                                        <th>ID</th>
                                                        <th>Marca</th>
                                                        <th>Modelo</th>
                                                        <th>Placa</th>
                                                        <th>Ano</th>
                                                        <th>Ações</th>
                                                    </tr>
                                                </thead>
                                                <tbody></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End Veicular Section -->

                    <!-- Profile Settings Section -->
                    <div id="profile-settings-section" class="content-section">
                        <h2><i class="fas fa-user mr-2"></i>Meu Perfil</h2>
                        <div class="row">
                            <div class="col-lg-4">
                                <div class="card shadow mb-4">
                                    <div class="card-header py-3">
                                        <h6 class="m-0 font-weight-bold text-primary">Foto de Perfil</h6>
                                    </div>
                                    <div class="card-body text-center">
                                        <img id="profile-preview" src="https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_960_720.png" 
                                             alt="Foto de Perfil" class="rounded-circle mb-3" width="150" height="150">
                                        <div>
                                            <label for="upload-profile-photo" class="btn btn-primary btn-sm">Alterar Foto</label>
                                            <input type="file" id="upload-profile-photo" accept="image/*" style="display: none;">
                                        </div>
                                        <hr>
                                        <div class="text-left">
                                            <h6 class="text-primary">User.Biel</h6>
                                            <p class="text-muted mb-1"><i class="fas fa-user-tag mr-1"></i>Administrador</p>
                                            <p class="text-muted mb-1"><i class="fas fa-calendar mr-1"></i>Desde: Jan 2025</p>
                                            <p class="text-muted mb-0"><i class="fas fa-clock mr-1"></i>Último acesso: Hoje</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-8">
                                <div class="card shadow mb-4">
                                    <div class="card-header py-3">
                                        <h6 class="m-0 font-weight-bold text-primary">Informações da Conta</h6>
                                    </div>
                                    <div class="card-body">
                                        <form id="profileForm">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label for="username">Nome de Usuário:</label>
                                                        <input type="text" id="username" value="User.Biel" class="form-control" readonly>
                                                        <small class="form-text text-muted">O nome de usuário não pode ser alterado</small>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label for="full-name">Nome Completo:</label>
                                                        <input type="text" id="full-name" value="Gabriel Silva" class="form-control" required>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label for="email">E-mail:</label>
                                                        <input type="email" id="email" value="user.biel@example.com" class="form-control" required>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label for="phone">Telefone:</label>
                                                        <input type="tel" id="phone" value="(11) 99999-9999" class="form-control" required>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label for="department">Departamento:</label>
                                                        <select id="department" class="form-control" required>
                                                            <option value="admin" selected>Administração</option>
                                                            <option value="ti">Tecnologia da Informação</option>
                                                            <option value="rh">Recursos Humanos</option>
                                                            <option value="financeiro">Financeiro</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label for="cargo">Cargo:</label>
                                                        <input type="text" id="cargo" value="Administrador do Sistema" class="form-control" required>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label for="data-nascimento">Data de Nascimento:</label>
                                                        <input type="date" id="data-nascimento" value="1990-01-15" class="form-control">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label for="endereco">Endereço:</label>
                                                        <input type="text" id="endereco" value="Rua das Flores, 123 - São Paulo/SP" class="form-control">
                                                    </div>
                                                </div>
                                            </div>
                                            <hr>
                                            <h6 class="text-primary mb-3">Alterar Senha</h6>
                                            <div class="row">
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label for="current-password">Senha Atual:</label>
                                                        <input type="password" id="current-password" class="form-control" placeholder="Digite sua senha atual">
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label for="new-password">Nova Senha:</label>
                                                        <input type="password" id="new-password" class="form-control" placeholder="Digite a nova senha">
                                                        <small class="form-text text-muted">Mínimo 6 caracteres</small>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <div class="form-group">
                                                        <label for="confirm-password">Confirmar Senha:</label>
                                                        <input type="password" id="confirm-password" class="form-control" placeholder="Confirme a nova senha">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="text-right">
                                                <button type="button" class="btn btn-secondary mr-2" onclick="resetProfileForm()">Cancelar</button>
                                                <button type="submit" class="btn btn-primary">Salvar Alterações</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                                
                                <!-- Preferências e Configurações Avançadas -->
                                <div class="card shadow mb-4">
                                    <div class="card-header py-3">
                                        <h6 class="m-0 font-weight-bold text-primary">Preferências de Notificação</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <div class="custom-control custom-switch">
                                                        <input type="checkbox" class="custom-control-input" id="email-notifications" checked>
                                                        <label class="custom-control-label" for="email-notifications">Notificações por E-mail</label>
                                                    </div>
                                                    <small class="form-text text-muted">Receber notificações de novas ocorrências por e-mail</small>
                                                </div>
                                                <div class="form-group">
                                                    <div class="custom-control custom-switch">
                                                        <input type="checkbox" class="custom-control-input" id="browser-notifications" checked>
                                                        <label class="custom-control-label" for="browser-notifications">Notificações do Navegador</label>
                                                    </div>
                                                    <small class="form-text text-muted">Permitir notificações push no navegador</small>
                                                </div>
                                                <div class="form-group">
                                                    <div class="custom-control custom-switch">
                                                        <input type="checkbox" class="custom-control-input" id="sound-notifications">
                                                        <label class="custom-control-label" for="sound-notifications">Notificações Sonoras</label>
                                                    </div>
                                                    <small class="form-text text-muted">Reproduzir som ao receber notificações</small>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="notification-frequency">Frequência de Notificações:</label>
                                                    <select id="notification-frequency" class="form-control">
                                                        <option value="instant" selected>Instantânea</option>
                                                        <option value="hourly">A cada hora</option>
                                                        <option value="daily">Diária</option>
                                                        <option value="weekly">Semanal</option>
                                                    </select>
                                                </div>
                                                <div class="form-group">
                                                    <label for="notification-types">Tipos de Notificação:</label>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="new-occurrence" checked>
                                                        <label class="form-check-label" for="new-occurrence">Novas Ocorrências</label>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="status-updates" checked>
                                                        <label class="form-check-label" for="status-updates">Atualizações de Status</label>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="system-alerts">
                                                        <label class="form-check-label" for="system-alerts">Alertas do Sistema</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Configurações de Privacidade -->
                                <div class="card shadow mb-4">
                                    <div class="card-header py-3">
                                        <h6 class="m-0 font-weight-bold text-primary">Configurações de Privacidade</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <div class="custom-control custom-switch">
                                                        <input type="checkbox" class="custom-control-input" id="profile-visibility" checked>
                                                        <label class="custom-control-label" for="profile-visibility">Perfil Visível</label>
                                                    </div>
                                                    <small class="form-text text-muted">Permitir que outros usuários vejam seu perfil</small>
                                                </div>
                                                <div class="form-group">
                                                    <div class="custom-control custom-switch">
                                                        <input type="checkbox" class="custom-control-input" id="activity-tracking">
                                                        <label class="custom-control-label" for="activity-tracking">Rastreamento de Atividade</label>
                                                    </div>
                                                    <small class="form-text text-muted">Permitir coleta de dados de uso para melhorias</small>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="data-retention">Retenção de Dados:</label>
                                                    <select id="data-retention" class="form-control">
                                                        <option value="30" selected>30 dias</option>
                                                        <option value="90">90 dias</option>
                                                        <option value="180">6 meses</option>
                                                        <option value="365">1 ano</option>
                                                        <option value="forever">Permanente</option>
                                                    </select>
                                                    <small class="form-text text-muted">Tempo de armazenamento dos dados de atividade</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Personalização da Interface -->
                                <div class="card shadow mb-4">
                                    <div class="card-header py-3">
                                        <h6 class="m-0 font-weight-bold text-primary">Personalização da Interface</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="theme-preference">Tema da Interface:</label>
                                                    <select id="theme-preference" class="form-control">
                                                        <option value="light" selected>Claro</option>
                                                        <option value="dark">Escuro</option>
                                                        <option value="auto">Automático</option>
                                                    </select>
                                                </div>
                                                <div class="form-group">
                                                    <label for="sidebar-position">Posição da Barra Lateral:</label>
                                                    <select id="sidebar-position" class="form-control">
                                                        <option value="left" selected>Esquerda</option>
                                                        <option value="right">Direita</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="items-per-page">Itens por Página:</label>
                                                    <select id="items-per-page" class="form-control">
                                                        <option value="10" selected>10</option>
                                                        <option value="25">25</option>
                                                        <option value="50">50</option>
                                                        <option value="100">100</option>
                                                    </select>
                                                </div>
                                                <div class="form-group">
                                                    <div class="custom-control custom-switch">
                                                        <input type="checkbox" class="custom-control-input" id="compact-mode">
                                                        <label class="custom-control-label" for="compact-mode">Modo Compacto</label>
                                                    </div>
                                                    <small class="form-text text-muted">Reduzir espaçamento entre elementos</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="text-right mt-3">
                                            <button type="button" class="btn btn-primary" onclick="saveUserPreferences()">Salvar Preferências</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End Profile Settings Section -->

                    <!-- Support Section -->
                    <div id="support-section" class="content-section">
                        <h2><i class="fas fa-question-circle mr-2"></i>Central de Suporte</h2>
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="card shadow mb-4">
                                    <div class="card-header py-3">
                                        <h6 class="m-0 font-weight-bold text-primary">Perguntas Frequentes (FAQ)</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="accordion" id="faqAccordion">
                                            <div class="card">
                                                <div class="card-header" id="faq1">
                                                    <h2 class="mb-0">
                                                        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapse1">
                                                            Como faço para registrar uma nova ocorrência?
                                                        </button>
                                                    </h2>
                                                </div>
                                                <div id="collapse1" class="collapse" data-parent="#faqAccordion">
                                                    <div class="card-body">
                                                        Para registrar uma nova ocorrência, clique no botão "Nova Ocorrência" no dashboard ou acesse a seção "Ocorrências" no menu lateral. Preencha todos os campos obrigatórios e clique em "Cadastrar Ocorrência".
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="card">
                                                <div class="card-header" id="faq2">
                                                    <h2 class="mb-0">
                                                        <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapse2">
                                                            Como alterar minha senha?
                                                        </button>
                                                    </h2>
                                                </div>
                                                <div id="collapse2" class="collapse" data-parent="#faqAccordion">
                                                    <div class="card-body">
                                                        Acesse "Meu Perfil" no menu lateral, role até a seção "Alterar Senha", digite sua senha atual e a nova senha duas vezes, depois clique em "Salvar Alterações".
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="card">
                                                <div class="card-header" id="faq3">
                                                    <h2 class="mb-0">
                                                        <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapse3">
                                                            Como visualizar o status das ocorrências?
                                                        </button>
                                                    </h2>
                                                </div>
                                                <div id="collapse3" class="collapse" data-parent="#faqAccordion">
                                                    <div class="card-body">
                                                        No dashboard principal, você pode ver as métricas de ocorrências pendentes e finalizadas. Para mais detalhes, acesse a seção "Ocorrências" onde encontrará uma tabela completa.
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="card">
                                                <div class="card-header" id="faq4">
                                                    <h2 class="mb-0">
                                                        <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapse4">
                                                            Como configurar notificações?
                                                        </button>
                                                    </h2>
                                                </div>
                                                <div id="collapse4" class="collapse" data-parent="#faqAccordion">
                                                    <div class="card-body">
                                                        Acesse "Configurações" no menu lateral e configure suas preferências de notificação por email, SMS ou push notifications.
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mt-4">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <h5>Contato Direto</h5>
                                                    <div class="contact-info">
                                                        <p><i class="fas fa-envelope mr-2"></i>Email: <a href="mailto:suporte@pr7.com.br">suporte@pr7.com.br</a></p>
                                                        <p><i class="fas fa-phone mr-2"></i>Telefone: (11) 3456-7890</p>
                                                        <p><i class="fas fa-whatsapp mr-2"></i>WhatsApp: (11) 99999-9999</p>
                                                        <p><i class="fas fa-clock mr-2"></i>Horário: Segunda a Sexta, 8h às 18h</p>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <h5>Abrir Ticket de Suporte</h5>
                                                    <form id="supportTicketForm">
                                                        <div class="form-group">
                                                            <label for="ticketSubject">Assunto:</label>
                                                            <input type="text" class="form-control" id="ticketSubject" required>
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="ticketPriority">Prioridade:</label>
                                                            <select class="form-control" id="ticketPriority" required>
                                                                <option value="baixa">Baixa</option>
                                                                <option value="media">Média</option>
                                                                <option value="alta">Alta</option>
                                                                <option value="urgente">Urgente</option>
                                                            </select>
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="ticketMessage">Mensagem:</label>
                                                            <textarea class="form-control" id="ticketMessage" rows="3" required></textarea>
                                                        </div>
                                                        <button type="submit" class="btn btn-primary">Enviar Ticket</button>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End Support Section -->

                    <!-- Location Section -->
                    <div id="location-section" class="content-section">
                        <h2><i class="fas fa-map-marker-alt mr-2"></i>Gerenciar Localizações</h2>
                        <div class="row">
                            <div class="col-lg-8">
                                <div class="card shadow mb-4">
                                    <div class="card-header py-3">
                                        <h6 class="m-0 font-weight-bold text-primary">Mapa de Localizações</h6>
                                    </div>
                                    <div class="card-body">
                                        <div id="map-local" style="height:400px; background-color: #f8f9fc; border: 1px solid #e3e6f0; border-radius: 0.35rem;">
                                            <div class="d-flex align-items-center justify-content-center h-100">
                                                <div class="text-center text-muted">
                                                    <i class="fas fa-map fa-3x mb-3"></i>
                                                    <p>Mapa será carregado aqui</p>
                                                    <small>Integração com Google Maps em desenvolvimento</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="card shadow mb-4">
                                    <div class="card-header py-3">
                                        <h6 class="m-0 font-weight-bold text-primary">Adicionar Local</h6>
                                    </div>
                                    <div class="card-body">
                                        <form id="addLocationForm">
                                            <div class="form-group">
                                                <label for="locationName">Nome do Local:</label>
                                                <input type="text" class="form-control" id="locationName" required>
                                            </div>
                                            <div class="form-group">
                                                <label for="locationAddress">Endereço:</label>
                                                <textarea class="form-control" id="locationAddress" rows="2" required></textarea>
                                            </div>
                                            <div class="form-group">
                                                <label for="locationCEP">CEP:</label>
                                                <input type="text" class="form-control" id="locationCEP" placeholder="00000-000">
                                            </div>
                                            <div class="form-group">
                                                <label for="locationType">Tipo:</label>
                                                <select class="form-control" id="locationType" required>
                                                    <option value="">Selecione o tipo</option>
                                                    <option value="sede">Sede</option>
                                                    <option value="filial">Filial</option>
                                                    <option value="deposito">Depósito</option>
                                                    <option value="cliente">Cliente</option>
                                                    <option value="fornecedor">Fornecedor</option>
                                                </select>
                                            </div>
                                            <button type="submit" class="btn btn-primary btn-block">Adicionar Local</button>
                                        </form>
                                    </div>
                                </div>
                                <div class="card shadow">
                                    <div class="card-header py-3">
                                        <h6 class="m-0 font-weight-bold text-primary">Locais Cadastrados</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="location-list">
                                            <div class="location-item mb-2 p-2 border rounded">
                                                <strong>Sede Principal</strong><br>
                                                <small class="text-muted">Rua das Flores, 123 - Centro</small>
                                                <div class="mt-1">
                                                    <button class="btn btn-sm btn-outline-primary">Editar</button>
                                                    <button class="btn btn-sm btn-outline-danger">Excluir</button>
                                                </div>
                                            </div>
                                            <div class="location-item mb-2 p-2 border rounded">
                                                <strong>Filial Norte</strong><br>
                                                <small class="text-muted">Av. Norte, 456 - Zona Norte</small>
                                                <div class="mt-1">
                                                    <button class="btn btn-sm btn-outline-primary">Editar</button>
                                                    <button class="btn btn-sm btn-outline-danger">Excluir</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End Location Section -->

                    <!-- System Config Section -->
                    <div id="system-config-section" class="content-section">
                        <h2><i class="fas fa-cog mr-2"></i>Configurações Avançadas do Sistema</h2>
                        
                        <!-- Navigation Tabs -->
                        <ul class="nav nav-tabs mb-4" id="configTabs" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" id="general-tab" data-toggle="tab" href="#general" role="tab">
                                    <i class="fas fa-cogs mr-1"></i>Geral
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="api-tab" data-toggle="tab" href="#api" role="tab">
                                    <i class="fas fa-plug mr-1"></i>API & Integração
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="security-tab" data-toggle="tab" href="#security" role="tab">
                                    <i class="fas fa-shield-alt mr-1"></i>Segurança
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="performance-tab" data-toggle="tab" href="#performance" role="tab">
                                    <i class="fas fa-tachometer-alt mr-1"></i>Performance
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="logs-tab" data-toggle="tab" href="#logs" role="tab">
                                    <i class="fas fa-file-alt mr-1"></i>Logs & Auditoria
                                </a>
                            </li>
                        </ul>

                        <div class="tab-content" id="configTabContent">
                            <!-- General Tab -->
                            <div class="tab-pane fade show active" id="general" role="tabpanel">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="card shadow mb-4">
                                            <div class="card-header py-3">
                                                <h6 class="m-0 font-weight-bold text-primary">Configurações Gerais</h6>
                                            </div>
                                            <div class="card-body">
                                                <form>
                                                    <div class="form-group">
                                                        <label for="system-name">Nome do Sistema:</label>
                                                        <input type="text" id="system-name" value="Sistema PR7" class="form-control">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="system-version">Versão:</label>
                                                        <input type="text" id="system-version" value="2.1.0" class="form-control" readonly>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="default-language">Idioma Padrão:</label>
                                                        <select id="default-language" class="form-control">
                                                            <option value="pt-br">Português (Brasil)</option>
                                                            <option value="en">English</option>
                                                            <option value="es">Español</option>
                                                            <option value="fr">Français</option>
                                                        </select>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="timezone">Fuso Horário:</label>
                                                        <select id="timezone" class="form-control">
                                                            <option value="America/Sao_Paulo" selected>São Paulo (GMT-3)</option>
                                                            <option value="America/New_York">New York (GMT-5)</option>
                                                            <option value="Europe/London">London (GMT+0)</option>
                                                            <option value="Asia/Tokyo">Tokyo (GMT+9)</option>
                                                        </select>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="date-format">Formato de Data:</label>
                                                        <select id="date-format" class="form-control">
                                                            <option value="dd/mm/yyyy" selected>DD/MM/AAAA</option>
                                                            <option value="mm/dd/yyyy">MM/DD/AAAA</option>
                                                            <option value="yyyy-mm-dd">AAAA-MM-DD</option>
                                                        </select>
                                                    </div>
                                                    <button type="submit" class="btn btn-primary">Salvar Configurações</button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="card shadow mb-4">
                                            <div class="card-header py-3">
                                                <h6 class="m-0 font-weight-bold text-primary">Aparência do Sistema</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="form-group">
                                                    <label>Tema do Sistema:</label>
                                                    <div class="btn-group d-block" role="group">
                                                        <button type="button" class="btn btn-outline-primary active" data-theme="light">
                                                            <i class="fas fa-sun mr-1"></i>Claro
                                                        </button>
                                                        <button type="button" class="btn btn-outline-primary" data-theme="dark">
                                                            <i class="fas fa-moon mr-1"></i>Escuro
                                                        </button>
                                                        <button type="button" class="btn btn-outline-primary" data-theme="auto">
                                                            <i class="fas fa-adjust mr-1"></i>Automático
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="sidebar-color">Cor da Barra Lateral:</label>
                                                    <select id="sidebar-color" class="form-control">
                                                        <option value="primary" selected>Azul Primário</option>
                                                        <option value="success">Verde</option>
                                                        <option value="info">Azul Claro</option>
                                                        <option value="warning">Amarelo</option>
                                                        <option value="danger">Vermelho</option>
                                                        <option value="dark">Escuro</option>
                                                    </select>
                                                </div>
                                                <div class="form-group mt-3">
                                                    <label>Notificações:</label>
                                                    <div class="custom-control custom-switch">
                                                        <input type="checkbox" class="custom-control-input" id="emailNotifications" checked>
                                                        <label class="custom-control-label" for="emailNotifications">Notificações por Email</label>
                                                    </div>
                                                    <div class="custom-control custom-switch">
                                                        <input type="checkbox" class="custom-control-input" id="smsNotifications">
                                                        <label class="custom-control-label" for="smsNotifications">Notificações por SMS</label>
                                                    </div>
                                                    <div class="custom-control custom-switch">
                                                        <input type="checkbox" class="custom-control-input" id="pushNotifications" checked>
                                                        <label class="custom-control-label" for="pushNotifications">Notificações Push</label>
                                                    </div>
                                                    <div class="custom-control custom-switch">
                                                        <input type="checkbox" class="custom-control-input" id="soundNotifications" checked>
                                                        <label class="custom-control-label" for="soundNotifications">Notificações Sonoras</label>
                                                    </div>
                                                </div>
                                                <button type="submit" class="btn btn-primary">Salvar Aparência</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- API & Integration Tab -->
                            <div class="tab-pane fade" id="api" role="tabpanel">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="card shadow mb-4">
                                            <div class="card-header py-3">
                                                <h6 class="m-0 font-weight-bold text-primary">Configurações de API</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="form-group">
                                                    <label for="api-base-url">URL Base da API:</label>
                                                    <input type="url" id="api-base-url" value="https://api.pr7.com.br/v1" class="form-control">
                                                </div>
                                                <div class="form-group">
                                                    <label for="api-key">Chave da API:</label>
                                                    <div class="input-group">
                                                        <input type="password" id="api-key" value="sk_live_xxxxxxxxxxxxxxxx" class="form-control">
                                                        <div class="input-group-append">
                                                            <button class="btn btn-outline-secondary" type="button" onclick="togglePasswordVisibility('api-key')">
                                                                <i class="fas fa-eye"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="api-timeout">Timeout da API (segundos):</label>
                                                    <input type="number" id="api-timeout" value="30" min="5" max="300" class="form-control">
                                                </div>
                                                <div class="form-group">
                                                    <label for="rate-limit">Limite de Requisições/min:</label>
                                                    <input type="number" id="rate-limit" value="100" min="10" max="1000" class="form-control">
                                                </div>
                                                <button type="button" class="btn btn-info mr-2">Testar Conexão</button>
                                                <button type="button" class="btn btn-primary">Salvar API</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="card shadow mb-4">
                                            <div class="card-header py-3">
                                                <h6 class="m-0 font-weight-bold text-primary">Integrações Externas</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="form-group">
                                                    <label>Google Maps API:</label>
                                                    <div class="custom-control custom-switch">
                                                        <input type="checkbox" class="custom-control-input" id="google-maps-enabled" checked>
                                                        <label class="custom-control-label" for="google-maps-enabled">Habilitado</label>
                                                    </div>
                                                    <input type="text" id="google-maps-key" placeholder="Chave da API do Google Maps" class="form-control mt-2">
                                                </div>
                                                <div class="form-group">
                                                    <label>Webhook URL:</label>
                                                    <input type="url" id="webhook-url" placeholder="https://seu-webhook.com/endpoint" class="form-control">
                                                </div>
                                                <div class="form-group">
                                                    <label>Integração com CRM:</label>
                                                    <select id="crm-integration" class="form-control">
                                                        <option value="none">Nenhum</option>
                                                        <option value="salesforce">Salesforce</option>
                                                        <option value="hubspot">HubSpot</option>
                                                        <option value="pipedrive">Pipedrive</option>
                                                        <option value="custom">Personalizado</option>
                                                    </select>
                                                </div>
                                                <button type="button" class="btn btn-primary">Salvar Integrações</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Security Tab -->
                            <div class="tab-pane fade" id="security" role="tabpanel">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="card shadow mb-4">
                                            <div class="card-header py-3">
                                                <h6 class="m-0 font-weight-bold text-primary">Backup e Segurança</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="form-group">
                                                    <label for="backupFrequency">Frequência de Backup:</label>
                                                    <select class="form-control" id="backupFrequency">
                                                        <option value="hourly">A cada hora</option>
                                                        <option value="daily">Diário</option>
                                                        <option value="weekly" selected>Semanal</option>
                                                        <option value="monthly">Mensal</option>
                                                    </select>
                                                </div>
                                                <div class="form-group">
                                                    <label for="backup-retention">Retenção de Backup (dias):</label>
                                                    <input type="number" class="form-control" id="backup-retention" value="30" min="1" max="365">
                                                </div>
                                                <div class="form-group">
                                                    <label for="sessionTimeout">Timeout de Sessão (minutos):</label>
                                                    <input type="number" class="form-control" id="sessionTimeout" value="30" min="5" max="480">
                                                </div>
                                                <div class="custom-control custom-switch">
                                                    <input type="checkbox" class="custom-control-input" id="twoFactorAuth">
                                                    <label class="custom-control-label" for="twoFactorAuth">Autenticação de Dois Fatores</label>
                                                </div>
                                                <div class="custom-control custom-switch">
                                                    <input type="checkbox" class="custom-control-input" id="auto-backup" checked>
                                                    <label class="custom-control-label" for="auto-backup">Backup Automático</label>
                                                </div>
                                                <div class="mt-3">
                                                    <button type="button" class="btn btn-success mr-2">Fazer Backup Agora</button>
                                                    <button type="button" class="btn btn-info">Exportar Dados</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="card shadow mb-4">
                                            <div class="card-header py-3">
                                                <h6 class="m-0 font-weight-bold text-primary">Políticas de Segurança</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="form-group">
                                                    <label for="password-policy">Política de Senha:</label>
                                                    <select id="password-policy" class="form-control">
                                                        <option value="basic">Básica (6+ caracteres)</option>
                                                        <option value="medium" selected>Média (8+ caracteres, números)</option>
                                                        <option value="strong">Forte (12+ caracteres, símbolos)</option>
                                                    </select>
                                                </div>
                                                <div class="form-group">
                                                    <label for="max-login-attempts">Máximo de Tentativas de Login:</label>
                                                    <input type="number" id="max-login-attempts" value="5" min="3" max="10" class="form-control">
                                                </div>
                                                <div class="form-group">
                                                    <label for="lockout-duration">Duração do Bloqueio (minutos):</label>
                                                    <input type="number" id="lockout-duration" value="15" min="5" max="60" class="form-control">
                                                </div>
                                                <div class="custom-control custom-switch">
                                                    <input type="checkbox" class="custom-control-input" id="ip-whitelist" checked>
                                                    <label class="custom-control-label" for="ip-whitelist">Lista Branca de IPs</label>
                                                </div>
                                                <div class="custom-control custom-switch">
                                                    <input type="checkbox" class="custom-control-input" id="ssl-required" checked>
                                                    <label class="custom-control-label" for="ssl-required">SSL Obrigatório</label>
                                                </div>
                                                <button type="button" class="btn btn-primary mt-3">Salvar Políticas</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Performance Tab -->
                            <div class="tab-pane fade" id="performance" role="tabpanel">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="card shadow mb-4">
                                            <div class="card-header py-3">
                                                <h6 class="m-0 font-weight-bold text-primary">Otimização de Performance</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="form-group">
                                                    <label for="cache-duration">Duração do Cache (minutos):</label>
                                                    <input type="number" id="cache-duration" value="60" min="5" max="1440" class="form-control">
                                                </div>
                                                <div class="form-group">
                                                    <label for="max-concurrent-users">Máximo de Usuários Simultâneos:</label>
                                                    <input type="number" id="max-concurrent-users" value="100" min="10" max="1000" class="form-control">
                                                </div>
                                                <div class="form-group">
                                                    <label for="page-size">Itens por Página:</label>
                                                    <select id="page-size" class="form-control">
                                                        <option value="10">10</option>
                                                        <option value="25" selected>25</option>
                                                        <option value="50">50</option>
                                                        <option value="100">100</option>
                                                    </select>
                                                </div>
                                                <div class="custom-control custom-switch">
                                                    <input type="checkbox" class="custom-control-input" id="enable-compression" checked>
                                                    <label class="custom-control-label" for="enable-compression">Compressão GZIP</label>
                                                </div>
                                                <div class="custom-control custom-switch">
                                                    <input type="checkbox" class="custom-control-input" id="lazy-loading" checked>
                                                    <label class="custom-control-label" for="lazy-loading">Carregamento Lazy</label>
                                                </div>
                                                <button type="button" class="btn btn-primary mt-3">Salvar Performance</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="card shadow mb-4">
                                            <div class="card-header py-3">
                                                <h6 class="m-0 font-weight-bold text-primary">Monitoramento do Sistema</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="row text-center">
                                                    <div class="col-md-6 mb-3">
                                                        <div class="border rounded p-3">
                                                            <h5 class="text-success">CPU</h5>
                                                            <h3>23%</h3>
                                                            <small class="text-muted">Uso atual</small>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <div class="border rounded p-3">
                                                            <h5 class="text-info">Memória</h5>
                                                            <h3>67%</h3>
                                                            <small class="text-muted">Uso atual</small>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <div class="border rounded p-3">
                                                            <h5 class="text-warning">Disco</h5>
                                                            <h3>45%</h3>
                                                            <small class="text-muted">Uso atual</small>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <div class="border rounded p-3">
                                                            <h5 class="text-primary">Usuários</h5>
                                                            <h3>12</h3>
                                                            <small class="text-muted">Online agora</small>
                                                        </div>
                                                    </div>
                                                </div>
                                                <button type="button" class="btn btn-info btn-block">Atualizar Estatísticas</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Logs & Audit Tab -->
                            <div class="tab-pane fade" id="logs" role="tabpanel">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="card shadow mb-4">
                                            <div class="card-header py-3">
                                                <h6 class="m-0 font-weight-bold text-primary">Configurações de Log e Auditoria</h6>
                                            </div>
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-lg-6">
                                                        <div class="form-group">
                                                            <label for="log-level">Nível de Log:</label>
                                                            <select id="log-level" class="form-control">
                                                                <option value="error">Apenas Erros</option>
                                                                <option value="warning">Avisos e Erros</option>
                                                                <option value="info" selected>Informações</option>
                                                                <option value="debug">Debug (Detalhado)</option>
                                                            </select>
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="log-retention">Retenção de Logs (dias):</label>
                                                            <input type="number" id="log-retention" value="90" min="7" max="365" class="form-control">
                                                        </div>
                                                        <div class="custom-control custom-switch">
                                                            <input type="checkbox" class="custom-control-input" id="audit-trail" checked>
                                                            <label class="custom-control-label" for="audit-trail">Trilha de Auditoria</label>
                                                        </div>
                                                        <div class="custom-control custom-switch">
                                                            <input type="checkbox" class="custom-control-input" id="user-activity-log" checked>
                                                            <label class="custom-control-label" for="user-activity-log">Log de Atividade do Usuário</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-6">
                                                        <div class="form-group">
                                                            <label>Eventos para Auditoria:</label>
                                                            <div class="custom-control custom-checkbox">
                                                                <input type="checkbox" class="custom-control-input" id="audit-login" checked>
                                                                <label class="custom-control-label" for="audit-login">Login/Logout</label>
                                                            </div>
                                                            <div class="custom-control custom-checkbox">
                                                                <input type="checkbox" class="custom-control-input" id="audit-crud" checked>
                                                                <label class="custom-control-label" for="audit-crud">Operações CRUD</label>
                                                            </div>
                                                            <div class="custom-control custom-checkbox">
                                                                <input type="checkbox" class="custom-control-input" id="audit-config" checked>
                                                                <label class="custom-control-label" for="audit-config">Mudanças de Configuração</label>
                                                            </div>
                                                            <div class="custom-control custom-checkbox">
                                                                <input type="checkbox" class="custom-control-input" id="audit-export">
                                                                <label class="custom-control-label" for="audit-export">Exportação de Dados</label>
                                                            </div>
                                                        </div>
                                                        <button id="btn-view-logs" type="button" class="btn btn-info mr-2">Visualizar Logs</button>
                                                        <button id="btn-clear-logs" type="button" class="btn btn-warning mr-2">Limpar Logs</button>
                                                        <button id="btn-export-logs" type="button" class="btn btn-success">Exportar Logs</button>
                                                        <div id="logs-output" class="mt-3">
                                                            <div class="text-muted">Nenhum log ainda.</div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <hr>
                                                <button type="button" class="btn btn-primary">Salvar Configurações de Log</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End System Config Section -->

                    <!-- About PR7 Section -->
                    <div id="about-pr7-section" class="content-section">
                        <h2><i class="fas fa-info-circle mr-2"></i>Sobre a PR7</h2>
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="card shadow mb-4">
                                    <div class="card-header py-3">
                                        <h6 class="m-0 font-weight-bold text-primary">PR7 - Soluções Tecnológicas</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="text-center mb-4">
                                            <i class="fas fa-code fa-4x text-primary mb-3"></i>
                                            <h3>PR7 - Soluções Tecnológicas</h3>
                                            <p class="text-muted">Inovação e Excelência em Sistemas de Gestão</p>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <h4>Quem Somos</h4>
                                                <p>A PR7 é uma empresa líder em desenvolvimento de soluções tecnológicas, especializada em sistemas de gestão e cadastro.</p>
                                                <h4>Nossa Missão</h4>
                                                <p>Desenvolver soluções tecnológicas inteligentes que transformem a forma como as empresas gerenciam seus dados.</p>
                                            </div>
                                            <div class="col-md-6">
                                                <h4>Contato</h4>
                                                <p><i class="fas fa-envelope mr-2"></i>contato@pr7.com.br</p>
                                                <p><i class="fas fa-phone mr-2"></i>(11) 9999-9999</p>
                                                <p><i class="fas fa-map-marker-alt mr-2"></i>São Paulo, SP - Brasil</p>
                                                <p><i class="fas fa-globe mr-2"></i>www.pr7.com.br</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End About PR7 Section -->

                    <!-- Logout Section -->
                    <div id="logout-section" class="content-section">
                        <div class="row justify-content-center">
                            <div class="col-lg-6">
                                <div class="card shadow">
                                    <div class="card-body text-center">
                                        <i class="fas fa-sign-out-alt fa-4x text-danger mb-4"></i>
                                        <h3>Sair do Sistema</h3>
                                        <p class="text-muted mb-4">Tem certeza que deseja sair do sistema?</p>
                                        <div>
                                            <button class="btn btn-danger mr-2" onclick="logout()">Confirmar Saída</button>
                                            <button class="btn btn-secondary" data-target="dashboard-section">Cancelar</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End Logout Section -->

                </div>
                <!-- /.container-fluid -->

            </div>
            <!-- End of Main Content -->

            

        </div>
        <!-- End of Content Wrapper -->

    </div>
    <!-- End of Page Wrapper -->

    

    <!-- Modais existentes serão mantidos aqui -->
    <!-- Modal de Cadastro -->
    <!-- Modal de Cadastro de Ocorrência -->
    <div class="modal fade" id="cadastroModal" tabindex="-1" role="dialog" aria-labelledby="cadastroModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="cadastroModalLabel">
                        <i class="fas fa-plus-circle mr-2"></i>Nova Ocorrência Patrimonial
                    </h5>
                    <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="form-ocorrencia" class="needs-validation" novalidate>
                        <!-- Seção: Dados Principais -->
                        <div class="card mb-4">
                            <div class="card-header bg-light">
                                <h6 class="m-0 font-weight-bold text-primary">
                                    <i class="fas fa-info-circle mr-2"></i>Dados Principais
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="solicitante" class="font-weight-bold">Solicitante <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control" id="solicitante" name="solicitante" required>
                                            <div class="invalid-feedback">Por favor, informe o solicitante.</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="cliente" class="font-weight-bold">Cliente <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control" id="cliente" name="cliente" required>
                                            <div class="invalid-feedback">Por favor, informe o cliente.</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label for="data" class="font-weight-bold">Data <span class="text-danger">*</span></label>
                                            <input type="date" class="form-control" id="data" name="data" required>
                                            <div class="invalid-feedback">Por favor, informe a data.</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label for="valor" class="font-weight-bold">Valor (R$)</label>
                                            <input type="text" class="form-control money-input" id="valor" name="valor" placeholder="0,00">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label for="conta" class="font-weight-bold">Conta</label>
                                            <input type="text" class="form-control" id="conta" name="conta">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label for="id_validacao" class="font-weight-bold">ID Validação</label>
                                            <input type="text" class="form-control" id="id_validacao" name="id_validacao">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="motivo" class="font-weight-bold">Motivo da Ocorrência <span class="text-danger">*</span></label>
                                            <input type="text" class="form-control" id="motivo" name="motivo" required>
                                            <div class="invalid-feedback">Por favor, informe o motivo da ocorrência.</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label for="filial" class="font-weight-bold">Filial</label>
                                            <input type="text" class="form-control" id="filial" name="filial">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label for="ordem_servico" class="font-weight-bold">Ordem de Serviço</label>
                                            <input type="text" class="form-control" id="ordem_servico" name="ordem_servico">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Seção: Endereço -->
                        <div class="card mb-4">
                            <div class="card-header bg-light">
                                <h6 class="m-0 font-weight-bold text-primary">
                                    <i class="fas fa-map-marker-alt mr-2"></i>Endereço
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label for="cep" class="font-weight-bold">CEP</label>
                                            <input type="text" class="form-control cep-input" id="cep" name="cep" maxlength="9" placeholder="00000-000">
                                            <div id="status" class="cep-status mt-1"></div>
                                            <small class="form-text text-muted">Digite o CEP para preenchimento automático</small>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label for="estado" class="font-weight-bold">Estado</label>
                                            <select class="form-control" id="estado" name="estado">
                                                <option value="">Selecione o estado</option>
                                                <option value="AC">Acre</option>
                                                <option value="AL">Alagoas</option>
                                                <option value="AP">Amapá</option>
                                                <option value="AM">Amazonas</option>
                                                <option value="BA">Bahia</option>
                                                <option value="CE">Ceará</option>
                                                <option value="DF">Distrito Federal</option>
                                                <option value="ES">Espírito Santo</option>
                                                <option value="GO">Goiás</option>
                                                <option value="MA">Maranhão</option>
                                                <option value="MT">Mato Grosso</option>
                                                <option value="MS">Mato Grosso do Sul</option>
                                                <option value="MG">Minas Gerais</option>
                                                <option value="PA">Pará</option>
                                                <option value="PB">Paraíba</option>
                                                <option value="PR">Paraná</option>
                                                <option value="PE">Pernambuco</option>
                                                <option value="PI">Piauí</option>
                                                <option value="RJ">Rio de Janeiro</option>
                                                <option value="RN">Rio Grande do Norte</option>
                                                <option value="RS">Rio Grande do Sul</option>
                                                <option value="RO">Rondônia</option>
                                                <option value="RR">Roraima</option>
                                                <option value="SC">Santa Catarina</option>
                                                <option value="SP">São Paulo</option>
                                                <option value="SE">Sergipe</option>
                                                <option value="TO">Tocantins</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="cidade" class="font-weight-bold">Cidade</label>
                                            <input type="text" class="form-control" id="cidade" name="cidade">
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label for="numero" class="font-weight-bold">Número</label>
                                            <input type="text" class="form-control" id="numero" name="numero">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label for="endereco" class="font-weight-bold">Endereço</label>
                                            <input type="text" class="form-control" id="endereco" name="endereco">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Seção: Equipe e Atendimento -->
                        <div class="card mb-4">
                            <div class="card-header bg-light">
                                <h6 class="m-0 font-weight-bold text-primary">
                                    <i class="fas fa-users mr-2"></i>Equipe e Atendimento
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label for="agente" class="font-weight-bold">Agente</label>
                                            <input type="text" class="form-control" id="agente" name="agente">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label for="equipe" class="font-weight-bold">Equipe</label>
                                            <input type="text" class="form-control" id="equipe" name="equipe">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label for="responsavel" class="font-weight-bold">Responsável</label>
                                            <input type="text" class="form-control" id="responsavel" name="responsavel">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label for="estabelecimento" class="font-weight-bold">Estabelecimento</label>
                                            <input type="text" class="form-control" id="estabelecimento" name="estabelecimento">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label for="hora_solicitada" class="font-weight-bold">Hora Solicitada</label>
                                            <input type="time" class="form-control" id="hora_solicitada" name="hora_solicitada">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label for="hora_local" class="font-weight-bold">Hora no Local</label>
                                            <input type="time" class="form-control" id="hora_local" name="hora_local">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label for="hora_saida" class="font-weight-bold">Hora de Saída</label>
                                            <input type="time" class="form-control" id="hora_saida" name="hora_saida">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label for="status_atendimento" class="font-weight-bold">Status</label>
                                            <select class="form-control" id="status_atendimento" name="status_atendimento">
                                                <option value="Em análise">Em análise</option>
                                                <option value="Finalizado">Finalizado</option>
                                                <option value="Cancelado">Cancelado</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="tipo_servico" class="font-weight-bold">Tipo de Serviço</label>
                                            <input type="text" class="form-control" id="tipo_servico" name="tipo_servico">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="pagamentos" class="font-weight-bold">Pagamentos</label>
                                            <input type="text" class="form-control" id="pagamentos" name="pagamentos">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="contato_local" class="font-weight-bold">Contato Local</label>
                                            <input type="text" class="form-control" id="contato_local" name="contato_local">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Seção: Verificações -->
                        <div class="card mb-4">
                            <div class="card-header bg-light">
                                <h6 class="m-0 font-weight-bold text-primary">
                                    <i class="fas fa-check-circle mr-2"></i>Verificações Realizadas
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="font-weight-bold">Portas e Arredores:</label>
                                            <div class="form-check-inline ml-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="portas_arredores" id="portas_sim" value="Sim">
                                                    <label class="form-check-label" for="portas_sim">Sim</label>
                                                </div>
                                                <div class="form-check ml-3">
                                                    <input class="form-check-input" type="radio" name="portas_arredores" id="portas_nao" value="Não">
                                                    <label class="form-check-label" for="portas_nao">Não</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="font-weight-bold">Local Energizado:</label>
                                            <div class="form-check-inline ml-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="local_energizado" id="energizado_sim" value="Sim">
                                                    <label class="form-check-label" for="energizado_sim">Sim</label>
                                                </div>
                                                <div class="form-check ml-3">
                                                    <input class="form-check-input" type="radio" name="local_energizado" id="energizado_nao" value="Não">
                                                    <label class="form-check-label" for="energizado_nao">Não</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="font-weight-bold">Sirene Disparada:</label>
                                            <div class="form-check-inline ml-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="sirene_disparada" id="sirene_sim" value="Sim">
                                                    <label class="form-check-label" for="sirene_sim">Sim</label>
                                                </div>
                                                <div class="form-check ml-3">
                                                    <input class="form-check-input" type="radio" name="sirene_disparada" id="sirene_nao" value="Não">
                                                    <label class="form-check-label" for="sirene_nao">Não</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label class="font-weight-bold">Local Violado:</label>
                                            <div class="form-check-inline ml-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="local_violado" id="violado_sim" value="Sim">
                                                    <label class="form-check-label" for="violado_sim">Sim</label>
                                                </div>
                                                <div class="form-check ml-3">
                                                    <input class="form-check-input" type="radio" name="local_violado" id="violado_nao" value="Não">
                                                    <label class="form-check-label" for="violado_nao">Não</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Seção: Relatório -->
                        <div class="card mb-4">
                            <div class="card-header bg-light">
                                <h6 class="m-0 font-weight-bold text-primary">
                                    <i class="fas fa-file-alt mr-2"></i>Relatório
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="form-group">
                                    <label for="relatorio" class="font-weight-bold">Relatório da Ocorrência <span class="text-danger">*</span></label>
                                    <textarea class="form-control" id="relatorio" name="relatorio" rows="5" maxlength="1000" 
                                        placeholder="Descreva detalhadamente os fatos ocorridos, procedimentos realizados e observações relevantes..." required></textarea>
                                    <div class="d-flex justify-content-between mt-1">
                                        <div class="invalid-feedback">Por favor, descreva o relatório da ocorrência.</div>
                                        <small class="text-muted">
                                            <span id="char-count">0</span>/1000 caracteres
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">
                        <i class="fas fa-times mr-2"></i>Cancelar
                    </button>
                    <button type="submit" form="form-ocorrencia" class="btn btn-primary">
                        <i class="fas fa-save mr-2"></i>Salvar Ocorrência
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap core JavaScript-->
            <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
            <script src="https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
            <script src="js/sb-admin-2.min.js"></script>
    
    <!-- Bootstrap Sidebar Navigation Script -->
    
    <!-- Sistema de Métricas e Scripts Customizados -->
            <script src="dashboard-metrics.js"></script>
            <script src="grid.js"></script>
            <script src="forms/cadastroModal.js"></script>
            <script src="forms/fieldEnhancements.js"></script>
            <script src="forms/photoUpload.js"></script>
            <script src="forms/cepService.js"></script>
            <script src="popups.js"></script>
            <script type="module">
            (async () => {
              const isHttpProtocol = location.protocol === 'http:' || location.protocol === 'https:';
              if (isHttpProtocol) {
                try {
                  const { getAccessibilityManager } = await import('./js/core/accessibility.js');
                  window.accessibilityManager = getAccessibilityManager();
                } catch (err) {
                  console.warn('Falha ao carregar módulo de acessibilidade:', err);
                }
              } else {
                console.warn('Acessibilidade ESM desativada no protocolo file://. Use http:// para habilitar.');
                // Fallback mínimo para evitar erros nas chamadas existentes
                window.accessibilityManager = window.accessibilityManager || {
                  openModal(modal, focusSelectors) {
                    if (!modal) return;
                    modal.classList.add('show');
                    modal.setAttribute('aria-hidden', 'false');
                    if (Array.isArray(focusSelectors)) {
                      for (const sel of focusSelectors) {
                        const el = document.querySelector(sel);
                        if (el) { el.focus(); break; }
                      }
                    } else {
                      const focusable = modal.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
                      if (focusable) focusable.focus();
                    }
                  },
                  closeModal(modal) {
                    if (!modal) return;
                    modal.classList.remove('show');
                    modal.setAttribute('aria-hidden', 'true');
                  }
                };
              }
            })();
            </script>
            <script src="index.js"></script>
            <script>
            document.addEventListener('DOMContentLoaded', function() {
                try {
                    var active = document.querySelector('.content-section.active');
                    if (!active) {
                        var first = document.querySelector('.content-section');
                        if (first) first.classList.add('active');
                    }
                } catch (e) {
                    console.warn('Fallback init error', e);
                }
            });
            </script>

    <script>
        // LISTENER PRINCIPAL CONSOLIDADO - Evita conflitos de múltiplos listeners
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== INICIALIZAÇÃO PRINCIPAL DO SISTEMA ===');
            
            // 1. NAVEGAÇÃO - Configurar primeiro para garantir funcionamento
            setTimeout(() => {
                console.log('=== CONFIGURANDO NAVEGAÇÃO ===');
                
                // Delegação de eventos na Sidebar para evitar perda de listeners
                const sidebar = document.getElementById('accordionSidebar');
                if (sidebar) {
                    sidebar.addEventListener('click', function(e) {
                        const link = e.target.closest('a.nav-link, a.sidebar-brand');
                        if (!link) return;

                        // Resolver target por data-target ou fallback do onclick
                        const dataTarget = link.getAttribute('data-target');
                        const onclickAttr = link.getAttribute('onclick') || '';
                        const onclickMatch = onclickAttr.match(/showSection\(['"]([^'"]+)['"]\)/);
                        const target = dataTarget || (onclickMatch ? onclickMatch[1] : null);

                        if (!target) return; // Sem target, não interceptar

                        e.preventDefault();
                        console.log(`=== CLICADO: ${target} ===`);
                        if (typeof showSection === 'function') {
                            showSection(target);
                        } else {
                            console.error('showSection não está disponível no escopo global');
                        }

                        // Atualizar link ativo visualmente (apenas na sidebar)
                        sidebar.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                        link.classList.add('active');
                    });
                    console.log('Delegação de navegação aplicada na sidebar');
                } else {
                    console.warn('Sidebar (#accordionSidebar) não encontrada para delegação');
                }

                // Delegação global para qualquer elemento com data-target fora da sidebar
                document.addEventListener('click', function(e) {
                    const el = e.target.closest('[data-target]');
                    if (!el) return;
                    // Ignorar se for dentro da sidebar (já tratado acima)
                    if (el.closest('#accordionSidebar')) return;
                    // Não interferir com abas do Bootstrap
                    const toggleAttr = (el.getAttribute('data-toggle') || '').toLowerCase();
                    if (toggleAttr === 'tab') return;

                    const target = el.getAttribute('data-target');
                    if (!target) return;

                    e.preventDefault();
                    console.log('Delegação global: navegando para', target);
                    if (typeof showSection === 'function') {
                        showSection(target);
                    }
                });

                // Mostrar dashboard por padrão apenas se nenhuma seção estiver ativa
                const anyActive = document.querySelector('.content-section.active');
                if (!anyActive && typeof showSection === 'function') {
                    showSection('dashboard-section');
                }
                console.log('=== NAVEGAÇÃO CONFIGURADA ===');
            }, 50);
            
            // 2. INICIALIZAR FUNCIONALIDADES EXISTENTES
            if (typeof initFormEnhancements === 'function') {
                initFormEnhancements();
            }
            if (typeof initCepService === 'function') {
                initCepService();
            }
            if (typeof initFieldEnhancements === 'function') {
                initFieldEnhancements();
            }
            
            // 3. ATUALIZAR MÉTRICAS DO DASHBOARD
            if (typeof updateDashboardStats === 'function') {
                updateDashboardStats();
            }
            
            // 4. RENDERIZAR DADOS EXISTENTES
            if (typeof renderOcorrenciasGrid === 'function') {
                renderOcorrenciasGrid();
            }
            
            // 5. INICIALIZAR SISTEMA DE OCORRÊNCIAS
            initOcorrenciasSystem();
            
            // 6. INICIALIZAR PERFIL DE USUÁRIO
            if (typeof loadUserProfile === 'function') {
                loadUserProfile();
            }
            if (typeof setupProfileHandlers === 'function') {
                setupProfileHandlers();
            }
            
            // 7. CONFIGURAR SISTEMA TODO
            const taskInput = document.getElementById('new-task-input');
            if (taskInput) {
                taskInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        addTask();
                    }
                });
            }
            
            // Carregar tarefas TODO
            if (typeof renderTasks === 'function') {
                renderTasks();
            }
            if (typeof updateTaskStats === 'function') {
                updateTaskStats();
            }
            
            // 8. CONFIGURAR OBSERVADOR DO MAPA
            const registerSection = document.getElementById('register-section');
            if (registerSection) {
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            setTimeout(() => {
                                if (typeof initMap === 'function') {
                                    initMap();
                                }
                            }, 500);
                        }
                    });
                });
                observer.observe(registerSection);
            }

            
            // FALLBACK DE VISIBILIDADE: garantir que a seção ativa esteja visível
            setTimeout(() => {
                try {
                    const activeSection = document.querySelector('.content-section.active');
                    if (activeSection) {
                        const cs = window.getComputedStyle(activeSection);
                        if (cs.display === 'none' || cs.visibility === 'hidden' || cs.opacity === '0') {
                            activeSection.style.display = 'block';
                            activeSection.style.visibility = 'visible';
                            activeSection.style.opacity = '1';
                            console.warn('Fallback: forçando exibição da seção ativa (possível conflito de CSS).');
                        }
                    }
                } catch (e) {
                    console.warn('Falha no fallback de visibilidade:', e);
                }
            }, 200);

            console.log('=== SISTEMA TOTALMENTE INICIALIZADO ===');
        });
        
        // Função para abrir modal de cadastro
        function openModal(tipo) {
            const modal = document.getElementById('cadastroModal');
            const tipoSelect = document.getElementById('tipoOcorrencia');
            
            if (modal && tipoSelect) {
                // Definir o tipo selecionado
                tipoSelect.value = tipo;
                
                // Abrir o modal usando Bootstrap
                $('#cadastroModal').modal('show');
            }
        }
        
        // Tornar função global
        window.openModal = openModal;
        
        // Sistema de Gerenciamento de Ocorrências
        let ocorrencias = JSON.parse(localStorage.getItem('ocorrencias')) || [];
        let nextId = parseInt(localStorage.getItem('nextOcorrenciaId')) || 1;
        
        // Inicializar dados de exemplo se não existirem
        if (ocorrencias.length === 0) {
            ocorrencias = [
                {
                    id: 1,
                    tipo: 'geral',
                    titulo: 'Manutenção do Sistema',
                    descricao: 'Realizar manutenção preventiva nos servidores',
                    prioridade: 'alta',
                    local: 'Sala de Servidores - Edifício Principal',
                    responsavel: 'João Silva',
                    status: 'Pendente',
                    data: new Date().toLocaleDateString('pt-BR'),
                    dataCompleta: new Date().toISOString()
                },
                {
                    id: 2,
                    tipo: 'patrimonial',
                    titulo: 'Inventário de Equipamentos',
                    descricao: 'Verificação e catalogação de todos os equipamentos do setor',
                    prioridade: 'media',
                    local: 'Departamento de TI',
                    responsavel: 'Maria Santos',
                    status: 'Em Andamento',
                    data: new Date().toLocaleDateString('pt-BR'),
                    dataCompleta: new Date().toISOString()
                },
                {
                    id: 3,
                    tipo: 'veicular',
                    titulo: 'Revisão da Frota',
                    descricao: 'Revisão preventiva dos veículos da empresa',
                    prioridade: 'baixa',
                    local: 'Garagem Central',
                    responsavel: 'Carlos Oliveira',
                    status: 'Concluída',
                    data: new Date().toLocaleDateString('pt-BR'),
                    dataCompleta: new Date().toISOString()
                }
            ];
            nextId = 4;
            localStorage.setItem('ocorrencias', JSON.stringify(ocorrencias));
            localStorage.setItem('nextOcorrenciaId', nextId.toString());
        }
        
        function initOcorrenciasSystem() {
            // Configurar formulário
            const form = document.getElementById('cadastroForm');
            if (form) {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    cadastrarOcorrencia();
                });
            }
            
            // Configurar botões de tipo
            document.querySelectorAll('[onclick^="openModal"]').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    const tipo = this.getAttribute('onclick').match(/openModal\('(.+)'\)/)[1];
                    document.getElementById('tipoOcorrencia').value = tipo;
                });
            });
            
            // Renderizar grid existente
            renderOcorrenciasGrid();
            updateDashboardStats();
        }
        
        function cadastrarOcorrencia() {
            const form = document.getElementById('cadastroForm');
            const formData = new FormData(form);
            
            // Validar campos
            const tipo = document.getElementById('tipoOcorrencia').value;
            const prioridade = document.getElementById('prioridade').value;
            const titulo = document.getElementById('titulo').value.trim();
            const descricao = document.getElementById('descricao').value.trim();
            const local = document.getElementById('local').value.trim();
            const responsavel = document.getElementById('responsavel').value.trim();
            
            if (!tipo || !prioridade || !titulo || !descricao || !local || !responsavel) {
                alert('Por favor, preencha todos os campos obrigatórios.');
                return;
            }
            
            // Criar nova ocorrência
            const novaOcorrencia = {
                id: nextId++,
                tipo: tipo,
                titulo: titulo,
                descricao: descricao,
                prioridade: prioridade,
                local: local,
                responsavel: responsavel,
                status: 'Pendente',
                data: new Date().toLocaleDateString('pt-BR'),
                dataCompleta: new Date().toISOString()
            };
            
            // Adicionar à lista
            ocorrencias.unshift(novaOcorrencia);
            
            // Salvar no localStorage
            localStorage.setItem('ocorrencias', JSON.stringify(ocorrencias));
            localStorage.setItem('nextOcorrenciaId', nextId.toString());
            
            // Criar tarefa TODO automaticamente para a nova ocorrência
            criarTodoParaOcorrencia(novaOcorrencia);
            
            // Limpar formulário
            limparFormulario();
            
            // Atualizar interface
            renderOcorrenciasGrid();
            updateDashboardStats();
            
            // Feedback
            alert('Ocorrência cadastrada com sucesso! Uma tarefa foi criada automaticamente no sistema TODO.');
        }
        
        function renderOcorrenciasGrid() {
            const tbody = document.querySelector('#grid-ocorrencias tbody');
            
            if (!tbody) return;
            
            // Dados estáticos de exemplo para ocorrências
            const ocorrenciasEstaticas = [
                {
                    id: 1,
                    titulo: 'Problema no Sistema de Login',
                    tipo: 'geral',
                    subtipo: 'Sistema',
                    status: 'Pendente',
                    prioridade: 'alta',
                    local: 'Servidor Principal',
                    data: '2025-01-15',
                    responsavel: 'Admin Sistema'
                },
                {
                    id: 2,
                    titulo: 'Manutenção Preventiva - Computador',
                    tipo: 'patrimonial',
                    subtipo: 'Equipamento',
                    status: 'Em Andamento',
                    prioridade: 'media',
                    local: 'Sala 101',
                    data: '2025-01-14',
                    responsavel: 'Técnico TI',
                    numeroPatrimonio: 'PAT001',
                    categoria: 'Informática'
                },
                {
                    id: 3,
                    titulo: 'Revisão Veicular - Frota',
                    tipo: 'veicular',
                    subtipo: 'Manutenção',
                    status: 'Concluída',
                    prioridade: 'baixa',
                    local: 'Garagem',
                    data: '2025-01-13',
                    responsavel: 'Mecânico',
                    placa: 'ABC-1234',
                    marca: 'Fiat',
                    modelo: 'Uno'
                }
            ];
            
            // Limpar tabela
            tbody.innerHTML = '';
            
            if (ocorrenciasEstaticas.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center text-muted">
                            <i class="fas fa-inbox fa-2x mb-2"></i><br>
                            Nenhuma ocorrência cadastrada ainda
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Renderizar ocorrências estáticas
            ocorrenciasEstaticas.forEach(ocorrencia => {
                const prioridadeClass = {
                    'baixa': 'success',
                    'media': 'warning', 
                    'alta': 'danger',
                    'critica': 'dark'
                }[ocorrencia.prioridade] || 'secondary';
                
                const statusClass = {
                    'Pendente': 'warning',
                    'Em Andamento': 'info',
                    'Concluída': 'success',
                    'Cancelada': 'danger'
                }[ocorrencia.status] || 'secondary';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>#${ocorrencia.id}</strong></td>
                    <td>${ocorrencia.titulo}</td>
                    <td><span class="badge badge-secondary">${ocorrencia.tipo}</span></td>
                    <td>${ocorrencia.subtipo}</td>
                    <td><span class="badge badge-${statusClass}">${ocorrencia.status}</span></td>
                    <td>${ocorrencia.local}</td>
                    <td>${ocorrencia.data}</td>
                    <td>
                        <div class="btn-group" role="group">
                            <button class="btn btn-sm btn-outline-primary" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-success" title="Localizar no Mapa">
                                <i class="fas fa-map-marker-alt"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function limparFormulario() {
            document.getElementById('cadastroForm').reset();
        }
        
        function editarOcorrencia(id) {
            const ocorrencia = ocorrencias.find(o => o.id === id);
            if (!ocorrencia) return;
            
            // Preencher formulário
            document.getElementById('tipoOcorrencia').value = ocorrencia.tipo;
            document.getElementById('prioridade').value = ocorrencia.prioridade;
            document.getElementById('titulo').value = ocorrencia.titulo;
            document.getElementById('descricao').value = ocorrencia.descricao;
            document.getElementById('local').value = ocorrencia.local;
            document.getElementById('responsavel').value = ocorrencia.responsavel;
            
            // Remover ocorrência atual para permitir edição
            excluirOcorrencia(id, false);
            
            // Scroll para o formulário
            document.getElementById('cadastroForm').scrollIntoView({ behavior: 'smooth' });
        }
        
        function alterarStatus(id) {
            const ocorrencia = ocorrencias.find(o => o.id === id);
            if (!ocorrencia) return;
            
            const statusOptions = ['Pendente', 'Em Andamento', 'Concluída', 'Cancelada'];
            const currentIndex = statusOptions.indexOf(ocorrencia.status);
            const nextIndex = (currentIndex + 1) % statusOptions.length;
            
            const novoStatus = statusOptions[nextIndex];
            ocorrencia.status = novoStatus;
            
            // Salvar alterações
            localStorage.setItem('ocorrencias', JSON.stringify(ocorrencias));
            
            // Atualizar TODOs vinculados à ocorrência
            atualizarTodosPorOcorrencia(id, novoStatus);
            
            // Atualizar interface
            renderOcorrenciasGrid();
            updateDashboardStats();
        }
        
        function excluirOcorrencia(id, confirmar = true) {
            if (confirmar && !confirm('Tem certeza que deseja excluir esta ocorrência?')) {
                return;
            }
            
            ocorrencias = ocorrencias.filter(o => o.id !== id);
            
            // Salvar alterações
            localStorage.setItem('ocorrencias', JSON.stringify(ocorrencias));
            
            // Atualizar interface
            renderOcorrenciasGrid();
            updateDashboardStats();
        }
        
        function exportarOcorrencias() {
            if (ocorrencias.length === 0) {
                alert('Não há ocorrências para exportar.');
                return;
            }
            
            const csv = 'ID,Tipo,Título,Descrição,Prioridade,Local,Responsável,Status,Data\n' +
                ocorrencias.map(o => 
                    `${o.id},"${o.tipo}","${o.titulo}","${o.descricao}","${o.prioridade}","${o.local}","${o.responsavel}","${o.status}","${o.data}"`
                ).join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ocorrencias_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }
        
        function limparTodasOcorrencias() {
            if (!confirm('Tem certeza que deseja excluir TODAS as ocorrências? Esta ação não pode ser desfeita.')) {
                return;
            }
            
            ocorrencias = [];
            nextId = 1;
            
            // Salvar alterações
            localStorage.setItem('ocorrencias', JSON.stringify(ocorrencias));
            localStorage.setItem('nextOcorrenciaId', nextId.toString());
            
            // Atualizar interface
            renderOcorrenciasGrid();
            updateDashboardStats();
            
            alert('Todas as ocorrências foram excluídas.');
        }
        
        function updateDashboardStats() {
            // Atualizar cards do dashboard
            const pendentes = ocorrencias.filter(o => o.status === 'Pendente').length;
            const finalizadas = ocorrencias.filter(o => o.status === 'Concluída').length;
            const total = ocorrencias.length;
            
            // Atualizar elementos do dashboard se existirem
            const pendentesEl = document.querySelector('[data-stat="pendentes"]');
            const finalizadasEl = document.querySelector('[data-stat="finalizadas"]');
            const totalEl = document.querySelector('[data-stat="total"]');
            
            if (pendentesEl) pendentesEl.textContent = pendentes;
            if (finalizadasEl) finalizadasEl.textContent = finalizadas;
            if (totalEl) totalEl.textContent = total;
        }
        
        // ===== SISTEMA DE SUPORTE =====
        let tickets = JSON.parse(localStorage.getItem('supportTickets')) || [];
        let nextTicketId = parseInt(localStorage.getItem('nextTicketId')) || 1;
        
        // Inicializar dados de exemplo para tickets se não existirem
        if (tickets.length === 0) {
            tickets = [
                {
                    id: 1,
                    titulo: 'Problema no Sistema de Login',
                    descricao: 'Usuários relatam dificuldade para fazer login no sistema',
                    categoria: 'tecnico',
                    prioridade: 'alta',
                    status: 'aberto',
                    usuario: 'João Silva',
                    email: 'joao.silva@empresa.com',
                    dataAbertura: new Date().toLocaleDateString('pt-BR'),
                    dataCompleta: new Date().toISOString()
                },
                {
                    id: 2,
                    titulo: 'Solicitação de Novo Usuário',
                    descricao: 'Criar acesso para novo funcionário do departamento de vendas',
                    categoria: 'acesso',
                    prioridade: 'media',
                    status: 'em_andamento',
                    usuario: 'Maria Santos',
                    email: 'maria.santos@empresa.com',
                    dataAbertura: new Date().toLocaleDateString('pt-BR'),
                    dataCompleta: new Date().toISOString()
                },
                {
                    id: 3,
                    titulo: 'Backup dos Dados',
                    descricao: 'Verificar se o backup automático está funcionando corretamente',
                    categoria: 'manutencao',
                    prioridade: 'baixa',
                    status: 'resolvido',
                    usuario: 'Carlos Oliveira',
                    email: 'carlos.oliveira@empresa.com',
                    dataAbertura: new Date().toLocaleDateString('pt-BR'),
                    dataCompleta: new Date().toISOString()
                }
            ];
            nextTicketId = 4;
            localStorage.setItem('supportTickets', JSON.stringify(tickets));
            localStorage.setItem('nextTicketId', nextTicketId.toString());
        }
        
        function initSupportSystem() {
            // Configurar formulário de ticket
            const ticketForm = document.getElementById('supportTicketForm');
            if (ticketForm) {
                ticketForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    criarTicket();
                });
            }
            
            // Adicionar seção de histórico de tickets após o formulário
            adicionarHistoricoTickets();
            renderHistoricoTickets();
        }
        
        function criarTicket() {
            const subject = document.getElementById('ticketSubject').value.trim();
            const priority = document.getElementById('ticketPriority').value;
            const message = document.getElementById('ticketMessage').value.trim();
            
            if (!subject || !message) {
                alert('Por favor, preencha todos os campos obrigatórios.');
                return;
            }
            
            const ticket = {
                id: nextTicketId++,
                subject: subject,
                priority: priority,
                message: message,
                status: 'Aberto',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                responses: []
            };
            
            tickets.push(ticket);
            
            // Salvar no localStorage
            localStorage.setItem('supportTickets', JSON.stringify(tickets));
            localStorage.setItem('nextTicketId', nextTicketId.toString());
            
            // Limpar formulário
            document.getElementById('supportTicketForm').reset();
            
            // Atualizar histórico
            renderHistoricoTickets();
            
            alert(`Ticket #${ticket.id} criado com sucesso! Nossa equipe entrará em contato em breve.`);
        }
        
        function adicionarHistoricoTickets() {
            const supportSection = document.getElementById('support-section');
            if (!supportSection || document.getElementById('ticketsHistory')) return;
            
            const historyHTML = `
                <div class="row mt-4">
                    <div class="col-lg-12">
                        <div class="card shadow mb-4">
                            <div class="card-header py-3 d-flex justify-content-between align-items-center">
                                <h6 class="m-0 font-weight-bold text-primary">Meus Tickets de Suporte</h6>
                                <button class="btn btn-sm btn-outline-danger" onclick="limparHistoricoTickets()">
                                    <i class="fas fa-trash"></i> Limpar Histórico
                                </button>
                            </div>
                            <div class="card-body">
                                <div id="ticketsHistory">
                                    <!-- Histórico será renderizado aqui -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            supportSection.insertAdjacentHTML('beforeend', historyHTML);
        }
        
        function renderHistoricoTickets() {
            const historyContainer = document.getElementById('ticketsHistory');
            if (!historyContainer) return;
            
            // Dados estáticos de tickets de suporte
            const ticketsEstaticos = [
                {
                    id: 1,
                    titulo: 'Problema de acesso ao sistema',
                    descricao: 'Não consigo fazer login no sistema desde ontem.',
                    prioridade: 'alta',
                    status: 'Em Andamento',
                    dataAbertura: '15/01/2024 09:30',
                    dataCompleta: '2024-01-15T09:30:00',
                    usuario: 'João Silva',
                    email: 'joao.silva@empresa.com'
                },
                {
                    id: 2,
                    titulo: 'Solicitação de nova funcionalidade',
                    descricao: 'Gostaria de solicitar a implementação de relatórios personalizados.',
                    prioridade: 'media',
                    status: 'Aberto',
                    dataAbertura: '14/01/2024 14:15',
                    dataCompleta: '2024-01-14T14:15:00',
                    usuario: 'Maria Santos',
                    email: 'maria.santos@empresa.com'
                },
                {
                    id: 3,
                    titulo: 'Bug no cadastro de ocorrências',
                    descricao: 'O sistema apresenta erro ao salvar ocorrências do tipo patrimonial.',
                    prioridade: 'urgente',
                    status: 'Resolvido',
                    dataAbertura: '13/01/2024 16:45',
                    dataCompleta: '2024-01-13T16:45:00',
                    usuario: 'Carlos Oliveira',
                    email: 'carlos.oliveira@empresa.com'
                }
            ];
            
            const ticketsHTML = ticketsEstaticos
                .sort((a, b) => new Date(b.dataCompleta) - new Date(a.dataCompleta))
                .map(ticket => {
                    const priorityClass = {
                        'baixa': 'success',
                        'media': 'warning', 
                        'alta': 'danger',
                        'urgente': 'dark'
                    }[ticket.prioridade] || 'secondary';
                    
                    const statusClass = {
                        'Aberto': 'primary',
                        'Em Andamento': 'warning',
                        'Resolvido': 'success',
                        'Fechado': 'secondary'
                    }[ticket.status] || 'secondary';
                    
                    return `
                        <div class="card mb-3 border-left-${priorityClass}">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <div>
                                    <strong>Ticket #${ticket.id}</strong> - ${ticket.titulo}
                                    <span class="badge badge-${priorityClass} ml-2">${ticket.prioridade.toUpperCase()}</span>
                                </div>
                                <div>
                                    <span class="badge badge-${statusClass}">${ticket.status}</span>
                                    <button class="btn btn-sm btn-outline-primary ml-2" title="Editar">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger ml-1" title="Excluir">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <p class="mb-2">${ticket.descricao}</p>
                                <small class="text-muted">
                                    <i class="fas fa-calendar"></i> Criado em: ${ticket.dataAbertura}
                                    <br><i class="fas fa-user"></i> Usuário: ${ticket.usuario}
                                    <br><i class="fas fa-envelope"></i> Email: ${ticket.email}
                                </small>
                            </div>
                        </div>
                    `;
                }).join('');
            
            historyContainer.innerHTML = ticketsHTML;
        }
        
        function alterarStatusTicket(ticketId) {
            const ticket = tickets.find(t => t.id === ticketId);
            if (!ticket) return;
            
            const novoStatus = prompt(`Status atual: ${ticket.status}\n\nEscolha o novo status:\n1 - Aberto\n2 - Em Andamento\n3 - Resolvido\n4 - Fechado`, '1');
            
            const statusMap = {
                '1': 'Aberto',
                '2': 'Em Andamento', 
                '3': 'Resolvido',
                '4': 'Fechado'
            };
            
            if (statusMap[novoStatus]) {
                ticket.status = statusMap[novoStatus];
                ticket.updatedAt = new Date().toISOString();
                
                // Simular resposta automática do suporte
                if (novoStatus === '3') {
                    ticket.responses.push({
                        message: 'Seu ticket foi marcado como resolvido. Se o problema persistir, entre em contato conosco novamente.',
                        createdAt: new Date().toISOString()
                    });
                }
                
                localStorage.setItem('supportTickets', JSON.stringify(tickets));
                renderHistoricoTickets();
                alert(`Status do ticket #${ticketId} alterado para: ${statusMap[novoStatus]}`);
            }
        }
        
        function excluirTicket(ticketId) {
            if (!confirm(`Tem certeza que deseja excluir o ticket #${ticketId}?`)) return;
            
            tickets = tickets.filter(t => t.id !== ticketId);
            localStorage.setItem('supportTickets', JSON.stringify(tickets));
            renderHistoricoTickets();
            alert(`Ticket #${ticketId} excluído com sucesso.`);
        }
        
        function limparHistoricoTickets() {
            if (!confirm('Tem certeza que deseja excluir TODOS os tickets? Esta ação não pode ser desfeita.')) return;
            
            tickets = [];
            nextTicketId = 1;
            localStorage.setItem('supportTickets', JSON.stringify(tickets));
            localStorage.setItem('nextTicketId', nextTicketId.toString());
            renderHistoricoTickets();
            alert('Histórico de tickets limpo com sucesso.');
        }
        
        // Inicializar sistema de suporte
        initSupportSystem();
    </script>
    
    <!-- Sistema de Gerenciamento de Localização -->
    <script>
        // Variáveis globais para localização
        let locations = JSON.parse(localStorage.getItem('locations')) || [];
        let nextLocationId = parseInt(localStorage.getItem('nextLocationId')) || 1;
        
        function initLocationSystem() {
            // Inicializar dados padrão se não existirem
            if (locations.length === 0) {
                locations = [
                    {
                        id: 1,
                        name: 'Sede Principal',
                        address: 'Rua das Flores, 123 - Centro',
                        cep: '01234-567',
                        type: 'sede',
                        coordinates: { lat: -23.5505, lng: -46.6333 },
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 2,
                        name: 'Filial Norte',
                        address: 'Av. Norte, 456 - Zona Norte',
                        cep: '02345-678',
                        type: 'filial',
                        coordinates: { lat: -23.5205, lng: -46.6133 },
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 3,
                        name: 'Departamento de TI',
                        address: 'Rua da Tecnologia, 789 - Centro',
                        cep: '03456-789',
                        type: 'departamento',
                        coordinates: { lat: -23.5405, lng: -46.6233 },
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 4,
                        name: 'Almoxarifado Central',
                        address: 'Av. Industrial, 321 - Zona Industrial',
                        cep: '04567-890',
                        type: 'almoxarifado',
                        coordinates: { lat: -23.5605, lng: -46.6433 },
                        createdAt: new Date().toISOString()
                    }
                ];
                nextLocationId = 5;
                localStorage.setItem('locations', JSON.stringify(locations));
                localStorage.setItem('nextLocationId', nextLocationId.toString());
            }
            
            // Configurar formulário
            const form = document.getElementById('addLocationForm');
            if (form) {
                form.addEventListener('submit', adicionarLocal);
            }
            
            // Renderizar lista de locais
            renderLocationList();
            
            // Configurar máscara de CEP
            const cepInput = document.getElementById('locationCEP');
            if (cepInput) {
                cepInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, '');
                    if (value.length > 5) {
                        value = value.substring(0, 5) + '-' + value.substring(5, 8);
                    }
                    e.target.value = value;
                });
            }
        }
        
        function adicionarLocal(e) {
            e.preventDefault();
            
            const name = document.getElementById('locationName').value.trim();
            const address = document.getElementById('locationAddress').value.trim();
            const cep = document.getElementById('locationCEP').value.trim();
            const type = document.getElementById('locationType').value;
            
            // Validações
            if (!name || !address || !type) {
                alert('Por favor, preencha todos os campos obrigatórios.');
                return;
            }
            
            if (cep && !/^\d{5}-?\d{3}$/.test(cep)) {
                alert('CEP deve estar no formato 00000-000.');
                return;
            }
            
            // Verificar se já existe local com mesmo nome
            if (locations.some(loc => loc.name.toLowerCase() === name.toLowerCase())) {
                alert('Já existe um local com este nome.');
                return;
            }
            
            // Criar novo local
            const newLocation = {
                id: nextLocationId++,
                name,
                address,
                cep: cep || 'Não informado',
                type,
                coordinates: generateRandomCoordinates(),
                createdAt: new Date().toISOString()
            };
            
            locations.push(newLocation);
            localStorage.setItem('locations', JSON.stringify(locations));
            localStorage.setItem('nextLocationId', nextLocationId.toString());
            
            // Limpar formulário
            document.getElementById('addLocationForm').reset();
            
            // Atualizar lista
            renderLocationList();
            
            alert(`Local "${name}" adicionado com sucesso!`);
        }
        
        function generateRandomCoordinates() {
            // Gerar coordenadas aleatórias próximas a São Paulo
            const baseLat = -23.5505;
            const baseLng = -46.6333;
            const variation = 0.1;
            
            return {
                lat: baseLat + (Math.random() - 0.5) * variation,
                lng: baseLng + (Math.random() - 0.5) * variation
            };
        }
        
        function renderLocationList() {
            const locationList = document.querySelector('.location-list');
            if (!locationList) return;
            
            if (locations.length === 0) {
                locationList.innerHTML = `
                    <div class="text-center text-muted py-4">
                        <i class="fas fa-map-marker-alt fa-2x mb-2"></i>
                        <p>Nenhum local cadastrado</p>
                        <small>Use o formulário ao lado para adicionar locais</small>
                    </div>
                `;
                return;
            }
            
            const typeLabels = {
                'sede': 'Sede',
                'filial': 'Filial',
                'deposito': 'Depósito',
                'cliente': 'Cliente',
                'fornecedor': 'Fornecedor'
            };
            
            const typeColors = {
                'sede': 'primary',
                'filial': 'success',
                'deposito': 'warning',
                'cliente': 'info',
                'fornecedor': 'secondary'
            };
            
            locationList.innerHTML = locations.map(location => `
                <div class="location-item mb-2 p-3 border rounded" data-location-id="${location.id}">
                    <div class="d-flex justify-content-between align-items-start">
                        <div class="flex-grow-1">
                            <strong class="d-block">${location.name}</strong>
                            <small class="text-muted d-block">${location.address}</small>
                            <small class="text-muted d-block">CEP: ${location.cep}</small>
                            <span class="badge badge-${typeColors[location.type]} mt-1">${typeLabels[location.type]}</span>
                        </div>
                        <div class="btn-group-vertical btn-group-sm">
                            <button class="btn btn-outline-primary btn-sm" onclick="editarLocal(${location.id})" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-outline-info btn-sm" onclick="visualizarNoMapa(${location.id})" title="Ver no Mapa">
                                <i class="fas fa-map-marker-alt"></i>
                            </button>
                            <button class="btn btn-outline-danger btn-sm" onclick="excluirLocal(${location.id})" title="Excluir">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function editarLocal(locationId) {
            const location = locations.find(loc => loc.id === locationId);
            if (!location) return;
            
            // Preencher formulário com dados do local
            document.getElementById('locationName').value = location.name;
            document.getElementById('locationAddress').value = location.address;
            document.getElementById('locationCEP').value = location.cep !== 'Não informado' ? location.cep : '';
            document.getElementById('locationType').value = location.type;
            
            // Remover local temporariamente para edição
            locations = locations.filter(loc => loc.id !== locationId);
            localStorage.setItem('locations', JSON.stringify(locations));
            renderLocationList();
            
            alert(`Local "${location.name}" carregado para edição. Modifique os dados e clique em "Adicionar Local" para salvar.`);
        }
        
        function visualizarNoMapa(locationId) {
            const location = locations.find(loc => loc.id === locationId);
            if (!location) return;
            
            // Simular visualização no mapa
            const mapDiv = document.getElementById('map-local');
            if (mapDiv) {
                mapDiv.innerHTML = `
                    <div class="d-flex align-items-center justify-content-center h-100">
                        <div class="text-center">
                            <i class="fas fa-map-marker-alt fa-3x text-primary mb-3"></i>
                            <h5>${location.name}</h5>
                            <p class="text-muted">${location.address}</p>
                            <p class="text-muted">CEP: ${location.cep}</p>
                            <span class="badge badge-info">Lat: ${location.coordinates.lat.toFixed(4)}, Lng: ${location.coordinates.lng.toFixed(4)}</span>
                            <br><br>
                            <button class="btn btn-sm btn-outline-secondary" onclick="resetarMapa()">
                                <i class="fas fa-undo"></i> Voltar ao Mapa
                            </button>
                        </div>
                    </div>
                `;
            }
            
            alert(`Visualizando "${location.name}" no mapa.`);
        }
        
        function resetarMapa() {
            const mapDiv = document.getElementById('map-local');
            if (mapDiv) {
                mapDiv.innerHTML = `
                    <div class="d-flex align-items-center justify-content-center h-100">
                        <div class="text-center text-muted">
                            <i class="fas fa-map fa-3x mb-3"></i>
                            <p>Mapa será carregado aqui</p>
                            <small>Integração com Google Maps em desenvolvimento</small>
                        </div>
                    </div>
                `;
            }
        }
        
        function excluirLocal(locationId) {
            const location = locations.find(loc => loc.id === locationId);
            if (!location) return;
            
            if (!confirm(`Tem certeza que deseja excluir o local "${location.name}"?`)) return;
            
            locations = locations.filter(loc => loc.id !== locationId);
            localStorage.setItem('locations', JSON.stringify(locations));
            renderLocationList();
            
            alert(`Local "${location.name}" excluído com sucesso.`);
        }
        
        function limparTodosLocais() {
            if (!confirm('Tem certeza que deseja excluir TODOS os locais? Esta ação não pode ser desfeita.')) return;
            
            locations = [];
            nextLocationId = 1;
            localStorage.setItem('locations', JSON.stringify(locations));
            localStorage.setItem('nextLocationId', nextLocationId.toString());
            renderLocationList();
            resetarMapa();
            
            alert('Todos os locais foram excluídos com sucesso.');
        }
        
        // Inicializar sistema de localização
        initLocationSystem();
    </script>
    
    <!-- Sistema de Configurações -->
    <script>
        // Sistema de Gerenciamento de Configurações
        function initSystemConfigSystem() {
            // Inicializar configurações padrão no localStorage
            if (!localStorage.getItem('systemConfig')) {
                const defaultConfig = {
                    systemName: 'Sistema PR7',
                    defaultLanguage: 'pt-br',
                    theme: 'light',
                    notifications: {
                        email: true,
                        sms: false,
                        push: true
                    },
                    backup: {
                        frequency: 'weekly',
                        lastBackup: null
                    },
                    security: {
                        sessionTimeout: 30,
                        twoFactorAuth: false
                    }
                };
                localStorage.setItem('systemConfig', JSON.stringify(defaultConfig));
            }
            
            loadSystemConfig();
            setupConfigEventListeners();
        }
        
        function loadSystemConfig() {
            const config = JSON.parse(localStorage.getItem('systemConfig'));
            
            // Carregar configurações gerais
            document.getElementById('system-name').value = config.systemName;
            document.getElementById('default-language').value = config.defaultLanguage;
            
            // Carregar tema
            document.querySelectorAll('[data-theme]').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-theme') === config.theme) {
                    btn.classList.add('active');
                }
            });
            
            // Carregar notificações
            document.getElementById('emailNotifications').checked = config.notifications.email;
            document.getElementById('smsNotifications').checked = config.notifications.sms;
            document.getElementById('pushNotifications').checked = config.notifications.push;
            
            // Carregar configurações de backup e segurança
            document.getElementById('backupFrequency').value = config.backup.frequency;
            document.getElementById('sessionTimeout').value = config.security.sessionTimeout;
            document.getElementById('twoFactorAuth').checked = config.security.twoFactorAuth;
            
            // Aplicar tema
            applyTheme(config.theme);
        }
        
        function setupConfigEventListeners() {
            // Formulário de configurações gerais
            const generalForm = document.querySelector('#system-config-section form');
            generalForm.addEventListener('submit', function(e) {
                e.preventDefault();
                saveGeneralConfig();
            });
            
            // Botões de tema
            document.querySelectorAll('[data-theme]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const theme = this.getAttribute('data-theme');
                    changeTheme(theme);
                });
            });
            
            // Switches de notificação
            document.querySelectorAll('.custom-control-input').forEach(input => {
                input.addEventListener('change', saveNotificationSettings);
            });
            
            // Configurações de backup e segurança
            document.getElementById('backupFrequency').addEventListener('change', saveBackupSettings);
            document.getElementById('sessionTimeout').addEventListener('change', saveSecuritySettings);
            document.getElementById('twoFactorAuth').addEventListener('change', saveSecuritySettings);
            
            // Botões de ação
            document.querySelector('.btn-success').addEventListener('click', performBackup);
            document.querySelector('.btn-info').addEventListener('click', exportData);

            // Fallback/robustez para abas de Configurações
            try {
                const tabsContainer = document.getElementById('configTabs');
                const tabContent = document.getElementById('configTabContent');
                if (tabsContainer && tabContent) {
                    const links = tabsContainer.querySelectorAll('a[data-toggle="tab"]');
                    const hasBootstrapTabs = typeof window.$ === 'function' && window.$.fn && window.$.fn.tab;

                    if (hasBootstrapTabs) {
                        // Garantir que tabs do Bootstrap funcionem ao clique
                        window.$(links).on('click', function(ev) {
                            ev.preventDefault();
                            window.$(this).tab('show');
                        });
                    } else {
                        // Fallback manual caso plugin de tabs não esteja disponível
                        links.forEach(link => {
                            link.addEventListener('click', function(ev) {
                                ev.preventDefault();
                                // Desativar links
                                links.forEach(l => l.classList.remove('active'));
                                this.classList.add('active');
                                // Ocultar todas as panes
                                tabContent.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('show', 'active'));
                                const targetSel = this.getAttribute('href');
                                const pane = targetSel ? document.querySelector(targetSel) : null;
                                if (pane) {
                                    pane.classList.add('show', 'active');
                                }
                            });
                        });
                    }
                }
            } catch (err) {
                console.warn('Falha ao inicializar abas de Configurações:', err);
            }
        }
        
        function saveGeneralConfig() {
            const config = JSON.parse(localStorage.getItem('systemConfig'));
            
            config.systemName = document.getElementById('system-name').value;
            config.defaultLanguage = document.getElementById('default-language').value;
            
            localStorage.setItem('systemConfig', JSON.stringify(config));
            
            // Atualizar título do sistema
            document.querySelector('.navbar-brand').textContent = config.systemName;
            
            showConfigAlert('Configurações gerais salvas com sucesso!', 'success');
        }
        
        function changeTheme(theme) {
            const config = JSON.parse(localStorage.getItem('systemConfig'));
            config.theme = theme;
            localStorage.setItem('systemConfig', JSON.stringify(config));
            
            // Atualizar botões
            document.querySelectorAll('[data-theme]').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-theme') === theme) {
                    btn.classList.add('active');
                }
            });
            
            applyTheme(theme);
            showConfigAlert(`Tema alterado para ${theme === 'light' ? 'claro' : 'escuro'}!`, 'info');
        }
        
        function applyTheme(theme) {
            const body = document.body;
            if (theme === 'dark') {
                body.style.backgroundColor = '#1a1a1a';
                body.style.color = '#ffffff';
                document.querySelectorAll('.card').forEach(card => {
                    card.style.backgroundColor = '#2d2d2d';
                    card.style.color = '#ffffff';
                });
            } else {
                body.style.backgroundColor = '';
                body.style.color = '';
                document.querySelectorAll('.card').forEach(card => {
                    card.style.backgroundColor = '';
                    card.style.color = '';
                });
            }
        }
        
        function saveNotificationSettings() {
            const config = JSON.parse(localStorage.getItem('systemConfig'));
            
            config.notifications.email = document.getElementById('emailNotifications').checked;
            config.notifications.sms = document.getElementById('smsNotifications').checked;
            config.notifications.push = document.getElementById('pushNotifications').checked;
            
            localStorage.setItem('systemConfig', JSON.stringify(config));
            showConfigAlert('Configurações de notificação salvas!', 'success');
        }
        
        function saveBackupSettings() {
            const config = JSON.parse(localStorage.getItem('systemConfig'));
            config.backup.frequency = document.getElementById('backupFrequency').value;
            localStorage.setItem('systemConfig', JSON.stringify(config));
            showConfigAlert('Configurações de backup salvas!', 'success');
        }
        
        function saveSecuritySettings() {
            const config = JSON.parse(localStorage.getItem('systemConfig'));
            config.security.sessionTimeout = parseInt(document.getElementById('sessionTimeout').value);
            config.security.twoFactorAuth = document.getElementById('twoFactorAuth').checked;
            localStorage.setItem('systemConfig', JSON.stringify(config));
            showConfigAlert('Configurações de segurança salvas!', 'success');
        }
        
        function performBackup() {
            const config = JSON.parse(localStorage.getItem('systemConfig'));
            config.backup.lastBackup = new Date().toISOString();
            localStorage.setItem('systemConfig', JSON.stringify(config));
            
            // Simular processo de backup
            const btn = document.querySelector('.btn-success');
            const originalText = btn.textContent;
            btn.textContent = 'Fazendo Backup...';
            btn.disabled = true;
            
            setTimeout(() => {
                btn.textContent = originalText;
                btn.disabled = false;
                showConfigAlert('Backup realizado com sucesso!', 'success');
            }, 2000);
        }
        
        function exportData() {
            const allData = {
                config: JSON.parse(localStorage.getItem('systemConfig') || '{}'),
                ocorrencias: JSON.parse(localStorage.getItem('ocorrencias') || '[]'),
                tickets: JSON.parse(localStorage.getItem('tickets') || '[]'),
                locais: JSON.parse(localStorage.getItem('locais') || '[]'),
                profile: JSON.parse(localStorage.getItem('userProfile') || '{}')
            };
            
            const dataStr = JSON.stringify(allData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `sistema_pr7_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
            showConfigAlert('Dados exportados com sucesso!', 'info');
        }
        
        function showConfigAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="close" data-dismiss="alert">
                    <span>&times;</span>
                </button>
            `;
            
            const configSection = document.getElementById('system-config-section');
            configSection.insertBefore(alertDiv, configSection.firstChild.nextSibling);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 3000);
        }
        
        // Inicializar sistema de configurações
        initSystemConfigSystem();
    </script>
    
    <!-- Script de Navegação Principal -->
    <script>
        // Função global para mostrar seções
        function showSection(sectionId) {
            console.log(`=== FUNÇÃO SHOWSECTION CHAMADA ===`);
            console.log(`Tentando mostrar seção: ${sectionId}`);
            const originalSectionId = sectionId; // manter referência para destacar nav corretamente
            
            // Throttle: evitar múltiplas execuções seguidas
            if (!window.__lastShowSectionCall) {
                window.__lastShowSectionCall = { id: null, ts: 0 };
            }
            const nowTs = Date.now();
            if (window.__lastShowSectionCall.id === sectionId && (nowTs - window.__lastShowSectionCall.ts) < 400) {
                console.log('Ignorando chamada repetida de showSection para', sectionId);
                return;
            }
            window.__lastShowSectionCall = { id: sectionId, ts: nowTs };
            
            // Se o alvo for Cadastros, mostrar barra de tipos e redirecionar para Patrimonial
            if (sectionId === 'register-section') {
                const typesNavEarly = document.getElementById('types-nav');
                if (typesNavEarly) typesNavEarly.classList.remove('hidden');
                const patrimonialBtnEarly = document.querySelector('.tipo-btn[data-tipo="patrimonial"]');
                if (patrimonialBtnEarly) {
                    document.querySelectorAll('.tipo-btn').forEach(btn => btn.classList.remove('active'));
                    patrimonialBtnEarly.classList.add('active');
                }
                console.log('Redirecionando para section-patrimonial a partir de register-section');
                sectionId = 'section-patrimonial';
            }

            // Validar seção alvo antes de esconder tudo (evita sumir conteúdo se ID inválido)
            let targetSection = document.getElementById(sectionId);
            if (!targetSection) {
                console.warn(`Seção '${sectionId}' não encontrada. Aplicando fallback...`);
                const fallbackSection = document.getElementById('dashboard-section') || document.querySelector('.content-section');
                if (fallbackSection) {
                    sectionId = fallbackSection.id;
                    targetSection = fallbackSection;
                    console.log(`Fallback aplicado para '${sectionId}'.`);
                } else {
                    console.error('Nenhuma seção disponível no DOM. Abortando showSection.');
                    return;
                }
            }

            // Esconder todas as seções somente após validar o alvo
            const allSections = document.querySelectorAll('.content-section');
            console.log(`Total de seções encontradas: ${allSections.length}`);
            allSections.forEach((section, index) => {
                console.log(`Escondendo seção ${index + 1}: ${section.id}`);
                // Remover estilos inline que podem conflitar
                section.style.removeProperty('display');
                section.style.removeProperty('visibility');
                section.removeAttribute('hidden');
                section.classList.remove('active');
            });

            // Mostrar seção alvo
            const typesNav = document.getElementById('types-nav');
            console.log(`Seção alvo encontrada:`, targetSection ? 'SIM' : 'NÃO');

                if (targetSection) {
                    console.log(`Aplicando classe active na seção ${sectionId}`);
                    
                    // Usar apenas classes CSS para controlar visibilidade
                    targetSection.classList.add('active');
                    // Remover ocultações adicionais e garantir visibilidade
                    targetSection.classList.remove('d-none');
                    targetSection.removeAttribute('hidden');
                    const cs = window.getComputedStyle(targetSection);
                    console.log(`Display computado: ${cs.display} | Visibility: ${cs.visibility}`);
                    console.log(`[Style] opacity: ${cs.opacity} | position: ${cs.position} | z-index: ${cs.zIndex} | overflow: ${cs.overflow}`);
                    const rect = targetSection.getBoundingClientRect();
                    console.log(`[Rect] width: ${rect.width}, height: ${rect.height}, top: ${rect.top}, left: ${rect.left}`);
                    console.log(`offsetParent: ${targetSection.offsetParent ? 'OK' : 'NULL'} | clientHeight: ${targetSection.clientHeight}`);

                    // Log da cadeia de ancestrais para detectar ocultação por containers
                    try {
                        let ancestor = targetSection.parentElement;
                        let depth = 0;
                        while (ancestor && depth < 6) {
                            const acs = window.getComputedStyle(ancestor);
                            console.log(`Ancestor[${depth}] ${ancestor.id ? '#'+ancestor.id : ancestor.className}: display=${acs.display}, visibility=${acs.visibility}, opacity=${acs.opacity}, overflow=${acs.overflow}`);
                            ancestor = ancestor.parentElement;
                            depth++;
                        }
                    } catch (e) {
                        console.warn('Falha ao inspecionar ancestrais:', e);
                    }

                    // Fallback imediato: se parecer oculto, forçar exibição inline
                    const looksHidden = (
                        cs.display === 'none' ||
                        cs.visibility === 'hidden' ||
                        parseFloat(cs.opacity || '1') === 0 ||
                        rect.width === 0 || rect.height === 0 ||
                        targetSection.offsetParent === null
                    );
                    if (looksHidden) {
                        console.warn('Seção ativa parece oculta; aplicando fallback inline.');
                        try {
                            targetSection.style.setProperty('display', 'block', 'important');
                            targetSection.style.setProperty('visibility', 'visible', 'important');
                            targetSection.style.setProperty('opacity', '1', 'important');
                        } catch (e) {
                            console.warn('Falha ao aplicar fallback inline:', e);
                        }
                    }

                // Evitar rolagem automática ao trocar seção para não ocultar a sidebar
                // Mantemos a posição atual do usuário, sem scrollIntoView

                // Remover overlays que possam bloquear visualização
                try {
                    const sidebarOverlay = document.getElementById('sidebar-overlay');
                    if (sidebarOverlay) {
                        sidebarOverlay.classList.remove('show', 'active');
                        sidebarOverlay.classList.add('hidden');
                    }
                    document.querySelectorAll('.modal-overlay').forEach(mo => {
                        mo.classList.remove('show');
                        mo.classList.add('hidden');
                    });
                } catch (e) {
                    console.warn('Falha ao limpar overlays:', e);
                }

                // Revalidar mapa quando a seção de ocorrências for ativada
                if (sectionId === 'section-ocorrencias') {
                    setTimeout(() => {
                        try {
                            if (typeof initMap === 'function') initMap();
                            if (typeof resizeMap === 'function') resizeMap();
                        } catch (_) {}
                    }, 100);
                }

                // Atualizar estado ativo na navegação (sidebar) com base no ID original clicado
                const navLinks = document.querySelectorAll('.nav-link[data-target], .sidebar-brand[data-target]');
                navLinks.forEach(l => l.classList.remove('active'));
                const activeNav = document.querySelector(`.nav-link[data-target="${originalSectionId}"]`) || document.querySelector(`.sidebar-brand[data-target="${originalSectionId}"]`);
                if (activeNav) activeNav.classList.add('active');
                
                // Exibir barra de botões de tipo quando seções de cadastro forem alvo
                if (typesNav) {
                    const isTypesSection = (
                        sectionId === 'section-ocorrencias' ||
                        sectionId === 'section-patrimonial' ||
                        sectionId === 'section-veicular'
                    );
                    typesNav.classList.toggle('hidden', !isTypesSection);

                    // Garantir estado visual ativo do botão correspondente quando navegado programaticamente
                    if (isTypesSection) {
                        const tipoButtons = document.querySelectorAll('.tipo-btn');
                        tipoButtons.forEach(b => b.classList.remove('active'));
                        let targetTipo = null;
                        if (sectionId === 'section-ocorrencias') targetTipo = 'ocorrencias';
                        else if (sectionId === 'section-patrimonial') targetTipo = 'patrimonial';
                        else if (sectionId === 'section-veicular') targetTipo = 'veicular';
                        if (targetTipo) {
                            const btn = document.querySelector(`.tipo-btn[data-tipo="${targetTipo}"]`);
                            if (btn) btn.classList.add('active');
                        }
                    }
                }
                
                // Se for register-section, ativar o botão patrimonial por padrão
                if (sectionId === 'register-section') {
                    const patrimonialBtn = document.querySelector('.tipo-btn[data-tipo="patrimonial"]');
                    
                    if (patrimonialBtn) {
                        // Remover active de todos os botões tipo
                        document.querySelectorAll('.tipo-btn').forEach(btn => btn.classList.remove('active'));
                        // Ativar botão patrimonial
                        patrimonialBtn.classList.add('active');
                    }
                    
                    // Não ativar nenhuma outra .content-section aqui; apenas register-section deve estar visível
                }
                
                // Função auxiliar para garantir renderização mínima
                const ensureRows = (tableSelector, emptyMessage) => {
                    const table = document.querySelector(tableSelector);
                    const tbody = table ? table.querySelector('tbody') : null;
                    const theadRow = table ? table.querySelector('thead tr') : null;
                    if (!tbody) {
                        console.warn('Tabela não encontrada para seletor:', tableSelector);
                        return;
                    }
                    // Remover mensagem anterior, se existir
                    const existing = tbody.querySelector('#noResultsRow');
                    if (existing) existing.remove();
                    const rowCount = tbody.querySelectorAll('tr').length;
                    if (rowCount === 0) {
                        const tr = document.createElement('tr');
                        tr.id = 'noResultsRow';
                        const td = document.createElement('td');
                        const colCount = theadRow ? theadRow.children.length : 1;
                        td.colSpan = colCount;
                        td.innerHTML = `<i class="bx bx-info-circle mr-2"></i>${emptyMessage}`;
                        tr.appendChild(td);
                        tbody.appendChild(tr);
                        console.log('Nenhuma linha encontrada; inserida mensagem de vazio em', tableSelector);
                    }
                };

                // Carregar dados específicos da seção sem localStorage
                setTimeout(() => {
                    switch(sectionId) {
                        case 'section-ocorrencias':
                            console.log('Carregando dados de ocorrências...');
                            if (typeof renderOcorrenciasGrid === 'function') {
                                try {
                                    renderOcorrenciasGrid();
                                } catch (e) {
                                    console.error('Erro ao renderizar ocorrências:', e);
                                }
                                ensureRows('#grid-ocorrencias', 'Nenhuma ocorrência encontrada no momento.');
                                const rows = document.querySelectorAll('#grid-ocorrencias tbody tr').length;
                                console.log(`Ocorrências: ${rows} linhas renderizadas`);
                            }
                            // Garantir inicialização do mapa ao abrir a seção
                            setTimeout(() => {
                                if (window.initMap) window.initMap();
                                if (window.resizeMap) window.resizeMap();
                            }, 100);
                            break;
                        
                        case 'section-patrimonial':
                            console.log('Carregando dados patrimoniais...');
                            if (typeof renderPatrimonialGrid === 'function') {
                                try {
                                    renderPatrimonialGrid();
                                } catch (e) {
                                    console.error('Erro ao renderizar patrimonial:', e);
                                }
                                ensureRows('#grid-patrimonial', 'Nenhum cadastro patrimonial disponível.');
                                const rows = document.querySelectorAll('#grid-patrimonial tbody tr').length;
                                console.log(`Patrimonial: ${rows} linhas renderizadas`);
                            }
                            break;
                        
                        case 'section-veicular':
                            console.log('Carregando dados veiculares...');
                            if (typeof renderVeicularGrid === 'function') {
                                try {
                                    renderVeicularGrid();
                                } catch (e) {
                                    console.error('Erro ao renderizar veicular:', e);
                                }
                                ensureRows('#grid-veicular', 'Nenhum cadastro veicular disponível.');
                                const rows = document.querySelectorAll('#grid-veicular tbody tr').length;
                                console.log(`Veicular: ${rows} linhas renderizadas`);
                            }
                            break;
                            
                        case 'register-section':
                            console.log('Inicializando seção de cadastros...');
                            if (typeof renderPatrimonialGrid === 'function') {
                                renderPatrimonialGrid();
                            }
                            if (typeof renderVeicularGrid === 'function') {
                                renderVeicularGrid();
                            }
                            ensureRows('#grid-patrimonial', 'Nenhum cadastro patrimonial disponível.');
                            ensureRows('#grid-veicular', 'Nenhum cadastro veicular disponível.');
                            break;
                            
                        case 'profile-settings-section':
                            console.log('Carregando perfil do usuário...');
                            if (typeof loadUserProfile === 'function') {
                                loadUserProfile();
                            }
                            break;
                            
                        case 'support-section':
                            console.log('Carregando sistema de suporte...');
                            if (typeof renderHistoricoTickets === 'function') {
                                renderHistoricoTickets();
                            }
                            break;
                            
                        case 'dashboard-section':
                            console.log('Atualizando dashboard...');
                            if (typeof updateDashboardStats === 'function') {
                                updateDashboardStats();
                            }
                            break;
                    }
                }, 100);
                
                console.log(`Seção ${sectionId} mostrada com sucesso`);
            } else {
                console.error(`ERRO CRÍTICO: Seção ${sectionId} não encontrada no DOM`);
                
                // Listar todas as seções disponíveis para debug
                console.log('Seções disponíveis:');
                allSections.forEach(section => {
                    console.log(`- ${section.id}`);
                });
            }
            
            console.log(`=== FIM FUNÇÃO SHOWSECTION ===`);
        }
        
        // NAVEGAÇÃO REMOVIDA - Agora está no listener principal consolidado
        
        // Sistema de Gerenciamento de Perfil
        let userProfile = JSON.parse(localStorage.getItem('userProfile')) || {
            username: 'User.Biel',
            fullName: 'Gabriel Silva',
            email: 'user.biel@example.com',
            phone: '(11) 99999-9999',
            department: 'admin',
            cargo: 'Administrador do Sistema',
            dataNascimento: '1990-01-15',
            endereco: 'Rua das Flores, 123 - São Paulo/SP',
            profileImage: 'https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_960_720.png'
        };
        
        // Salvar perfil no localStorage se não existir
        if (!localStorage.getItem('userProfile')) {
            localStorage.setItem('userProfile', JSON.stringify(userProfile));
        }
        
        // PERFIL REMOVIDO - Agora está no listener principal consolidado
        
        // Carregar dados do perfil
        function loadUserProfile() {
            // Dados estáticos do perfil do usuário
            const perfilEstatico = {
                profileImage: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUwIiBoZWlnaHQ9IjE1MCIgdmlld0JveD0iMCAwIDE1MCAxNTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxNTAiIGhlaWdodD0iMTUwIiBmaWxsPSIjNjc4M0E0Ii8+CjxjaXJjbGUgY3g9Ijc1IiBjeT0iNjAiIHI9IjI1IiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBkPSJNNzUgOTBDNTUgOTAgNDAgMTA1IDQwIDEyNUgxMTBDMTEwIDEwNSA5NSA5MCA3NSA5MFoiIGZpbGw9IndoaXRlIi8+Cjx0ZXh0IHg9Ijc1IiB5PSIxMzUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPlVzZXI8L3RleHQ+Cjwvc3ZnPgo=',
                username: 'admin',
                fullName: 'Administrador do Sistema',
                email: 'admin@sistema.com',
                phone: '(11) 99999-9999',
                department: 'Tecnologia da Informação',
                cargo: 'Administrador',
                dataNascimento: '1990-01-01',
                endereco: 'Rua Principal, 123 - Centro'
            };
            
            const profileImage = document.getElementById('profile-preview');
            if (profileImage) profileImage.src = perfilEstatico.profileImage;
            
            const username = document.getElementById('username');
            if (username) username.value = perfilEstatico.username;
            
            const fullName = document.getElementById('full-name');
            if (fullName) fullName.value = perfilEstatico.fullName;
            
            const email = document.getElementById('email');
            if (email) email.value = perfilEstatico.email;
            
            const phone = document.getElementById('phone');
            if (phone) phone.value = perfilEstatico.phone;
            
            const department = document.getElementById('department');
            if (department) department.value = perfilEstatico.department;
            
            const cargo = document.getElementById('cargo');
            if (cargo) cargo.value = perfilEstatico.cargo;
            
            const dataNascimento = document.getElementById('data-nascimento');
            if (dataNascimento) dataNascimento.value = perfilEstatico.dataNascimento;
            
            const endereco = document.getElementById('endereco');
            if (endereco) endereco.value = perfilEstatico.endereco;
        }
        
        // Configurar handlers do perfil
        function setupProfileHandlers() {
            // Upload de foto
            const photoInput = document.getElementById('upload-profile-photo');
            if (photoInput) {
                photoInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const imageUrl = e.target.result;
                            const profileImage = document.getElementById('profile-preview');
                            if (profileImage) {
                                profileImage.src = imageUrl;
                                userProfile.profileImage = imageUrl;
                                localStorage.setItem('userProfile', JSON.stringify(userProfile));
                            }
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
            
            // Formulário de perfil
            const profileForm = document.getElementById('profileForm');
            if (profileForm) {
                profileForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Validar senhas se foram preenchidas
                    const currentPassword = document.getElementById('current-password');
                    const newPassword = document.getElementById('new-password');
                    const confirmPassword = document.getElementById('confirm-password');
                    
                    if (newPassword && confirmPassword && (newPassword.value || confirmPassword.value)) {
                        if (!currentPassword || !currentPassword.value) {
                            alert('Digite a senha atual para alterar a senha.');
                            return;
                        }
                        if (newPassword.value !== confirmPassword.value) {
                            alert('A nova senha e a confirmação não coincidem.');
                            return;
                        }
                        if (newPassword.value.length < 6) {
                            alert('A nova senha deve ter pelo menos 6 caracteres.');
                            return;
                        }
                    }
                    
                    // Atualizar dados do perfil
                    const fullName = document.getElementById('full-name');
                    if (fullName) userProfile.fullName = fullName.value;
                    
                    const email = document.getElementById('email');
                    if (email) userProfile.email = email.value;
                    
                    const phone = document.getElementById('phone');
                    if (phone) userProfile.phone = phone.value;
                    
                    const department = document.getElementById('department');
                    if (department) userProfile.department = department.value;
                    
                    const cargo = document.getElementById('cargo');
                    if (cargo) userProfile.cargo = cargo.value;
                    
                    const dataNascimento = document.getElementById('data-nascimento');
                    if (dataNascimento) userProfile.dataNascimento = dataNascimento.value;
                    
                    const endereco = document.getElementById('endereco');
                    if (endereco) userProfile.endereco = endereco.value;
                    
                    localStorage.setItem('userProfile', JSON.stringify(userProfile));
                    
                    // Limpar campos de senha
                    if (currentPassword) currentPassword.value = '';
                    if (newPassword) newPassword.value = '';
                    if (confirmPassword) confirmPassword.value = '';
                    
                    alert('Perfil atualizado com sucesso!');
                });
            }
        }
        
        // Resetar formulário de perfil
        function resetProfileForm() {
            if (confirm('Descartar todas as alterações?')) {
                loadUserProfile();
                const currentPassword = document.getElementById('current-password');
                const newPassword = document.getElementById('new-password');
                const confirmPassword = document.getElementById('confirm-password');
                
                if (currentPassword) currentPassword.value = '';
                if (newPassword) newPassword.value = '';
                if (confirmPassword) confirmPassword.value = '';
            }
        }
        
        // ===== SISTEMA DE TODO/TASKS =====
        let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
        let taskIdCounter = parseInt(localStorage.getItem('taskIdCounter')) || 1;
        
        // Adicionar nova tarefa
        function addTask() {
            const input = document.getElementById('new-task-input');
            const taskText = input.value.trim();
            
            if (taskText === '') {
                alert('Por favor, digite uma tarefa.');
                return;
            }
            
            const newTask = {
                id: taskIdCounter++,
                text: taskText,
                completed: false,
                createdAt: new Date().toISOString(),
                priority: 'medium'
            };
            
            tasks.push(newTask);
            saveTasks();
            input.value = '';
            renderTasks();
            updateTaskStats();
        }
        
        // Renderizar lista de tarefas
        function renderTasks() {
            const container = document.getElementById('tasks-container');
            
            if (tasks.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-muted py-3">
                        <i class="fas fa-tasks fa-2x mb-2 d-block"></i>
                        <span>Nenhuma tarefa adicionada</span>
                        <br>
                        <small>Digite uma tarefa acima para começar</small>
                    </div>
                `;
                return;
            }
            
            let html = '';
            tasks.forEach(task => {
                const completedClass = task.completed ? 'completed-task' : '';
                const checkedAttr = task.completed ? 'checked' : '';
                const priorityColor = getPriorityColor(task.priority);
                
                html += `
                    <div class="task-item ${completedClass} mb-2 p-2 border rounded" data-task-id="${task.id}">
                        <div class="d-flex align-items-center">
                            <div class="custom-control custom-checkbox mr-2">
                                <input type="checkbox" class="custom-control-input" id="task-${task.id}" ${checkedAttr} onchange="toggleTask(${task.id})">
                                <label class="custom-control-label" for="task-${task.id}"></label>
                            </div>
                            <div class="flex-grow-1">
                                <span class="task-text ${task.completed ? 'text-muted' : ''}">${task.text}</span>
                                <div class="task-meta text-xs text-muted mt-1">
                                    <span class="badge badge-${priorityColor} badge-sm mr-1">${task.priority}</span>
                                    ${task.tipo === 'ocorrencia-auto' ? '<span class="badge badge-info badge-sm mr-1" title="Criada automaticamente a partir de ocorrência"><i class="fas fa-robot"></i> Auto</span>' : ''}
                                    <span>${formatDate(task.createdAt)}</span>
                                </div>
                            </div>
                            <div class="task-actions">
                                ${task.tipo === 'ocorrencia-auto' && task.ocorrenciaId ? `<button class="btn btn-sm btn-outline-primary mr-1" onclick="localizarNoMapa(${task.ocorrenciaId})" title="Ver Ocorrência no Mapa"><i class="fas fa-map-marker-alt"></i></button>` : ''}
                                <button class="btn btn-sm btn-outline-secondary mr-1" onclick="editTask(${task.id})" title="Editar">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteTask(${task.id})" title="Excluir">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Alternar status da tarefa
        function toggleTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                saveTasks();
                renderTasks();
                updateTaskStats();
            }
        }
        
        // Excluir tarefa
        function deleteTask(taskId) {
            if (confirm('Deseja realmente excluir esta tarefa?')) {
                tasks = tasks.filter(t => t.id !== taskId);
                saveTasks();
                renderTasks();
                updateTaskStats();
            }
        }
        
        // Editar tarefa
        function editTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                const newText = prompt('Editar tarefa:', task.text);
                if (newText && newText.trim() !== '') {
                    task.text = newText.trim();
                    saveTasks();
                    renderTasks();
                }
            }
        }
        
        // Limpar tarefas concluídas
        function clearCompletedTasks() {
            const completedCount = tasks.filter(t => t.completed).length;
            if (completedCount === 0) {
                alert('Não há tarefas concluídas para limpar.');
                return;
            }
            
            if (confirm(`Deseja remover ${completedCount} tarefa(s) concluída(s)?`)) {
                tasks = tasks.filter(t => !t.completed);
                saveTasks();
                renderTasks();
                updateTaskStats();
            }
        }
        
        // Atualizar estatísticas das tarefas
        function updateTaskStats() {
            const total = tasks.length;
            const completed = tasks.filter(t => t.completed).length;
            const pending = total - completed;
            const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
            
            document.getElementById('total-tasks').textContent = total;
            document.getElementById('pending-tasks').textContent = pending;
            document.getElementById('completed-tasks').textContent = completed;
            document.getElementById('progress-percentage').textContent = percentage + '%';
            
            const progressBar = document.getElementById('progress-bar');
            progressBar.style.width = percentage + '%';
            progressBar.setAttribute('aria-valuenow', percentage);
        }
        
        // Salvar tarefas no localStorage
        function saveTasks() {
            localStorage.setItem('tasks', JSON.stringify(tasks));
            localStorage.setItem('taskIdCounter', taskIdCounter.toString());
        }
        
        // Obter cor da prioridade
        function getPriorityColor(priority) {
            const colors = {
                'low': 'success',
                'medium': 'warning', 
                'high': 'danger',
                'critical': 'dark'
            };
            return colors[priority] || 'secondary';
        }
        
        // Formatar data
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR') + ' ' + date.toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'});
        }
        
        // Exportar tarefas
        function exportTasks() {
            if (tasks.length === 0) {
                alert('Não há tarefas para exportar.');
                return;
            }
            
            const dataStr = JSON.stringify(tasks, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'tarefas_' + new Date().toISOString().split('T')[0] + '.json';
            link.click();
            URL.revokeObjectURL(url);
        }
        
        // Adicionar tarefa via Enter
        // TODO REMOVIDO - Agora está no listener principal consolidado
        
        // Função para criar TODO automaticamente a partir de ocorrência
        function criarTodoParaOcorrencia(ocorrencia) {
            if (!ocorrencia) return;
            
            // Definir prioridade da tarefa baseada na prioridade da ocorrência
            const prioridadeMap = {
                'baixa': 'low',
                'media': 'medium',
                'alta': 'high',
                'critica': 'high'
            };
            
            const prioridadeTarefa = prioridadeMap[ocorrencia.prioridade] || 'medium';
            
            // Criar texto da tarefa
            const textoTarefa = `Resolver: ${ocorrencia.titulo} (ID: ${ocorrencia.id})`;
            
            // Criar nova tarefa
            const novaTarefa = {
                id: Date.now() + Math.random(), // ID único
                text: textoTarefa,
                priority: prioridadeTarefa,
                completed: false,
                createdAt: new Date().toISOString(),
                ocorrenciaId: ocorrencia.id, // Vincular à ocorrência
                tipo: 'ocorrencia-auto' // Marcar como criada automaticamente
            };
            
            // Adicionar à lista de tarefas
            tasks.push(novaTarefa);
            
            // Salvar no localStorage
            saveTasks();
            
            // Atualizar interface
            renderTasks();
            updateTaskStats();
            
            console.log('✅ Tarefa TODO criada automaticamente para ocorrência:', ocorrencia.id);
        }
        
        // Função para marcar tarefa como concluída quando ocorrência for resolvida
        function atualizarTodosPorOcorrencia(ocorrenciaId, novoStatus) {
            const tarefasVinculadas = tasks.filter(task => task.ocorrenciaId === ocorrenciaId);
            
            tarefasVinculadas.forEach(task => {
                if (novoStatus === 'Concluída' && !task.completed) {
                    task.completed = true;
                    console.log('✅ Tarefa TODO marcada como concluída automaticamente:', task.id);
                } else if (novoStatus !== 'Concluída' && task.completed) {
                    task.completed = false;
                    console.log('🔄 Tarefa TODO reaberta automaticamente:', task.id);
                }
            });
            
            // Salvar alterações
            saveTasks();
            renderTasks();
            updateTaskStats();
        }
        
        // ===== FIM SISTEMA DE TODO/TASKS =====
    </script>
    
    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script>
        // Captura de logs já configurada no <head>; evitar duplicidade aqui.
        (function setupLogsUI(){
            function byId(id){ return document.getElementById(id); }
            function renderLogs(){
                var container = byId('logs-output');
                if (!container) return;
                var levelSelect = byId('log-level');
                var selected = levelSelect ? levelSelect.value : 'info';
                var allow = {
                    error: ['error'],
                    warning: ['warn','error'],
                    info: ['log','info','warn','error'],
                    debug: ['debug','log','info','warn','error']
                }[selected] || ['log','info','warn','error'];
                var logs = (window.__appLogs || []).filter(function(l){ return allow.indexOf(l.level) !== -1; });
                var totalAll = (window.__appLogs || []).length;
                var totalShown = logs.length;
                if (!logs.length) {
                    container.innerHTML = '<div class="d-flex justify-content-between align-items-center mb-2">'
                        + '<small class="text-muted">Total: '+String(totalAll)+' • Filtrados: '+String(totalShown)+'</small>'
                        + '<small class="text-muted">Atualizado: '+new Date().toLocaleTimeString()+'</small>'
                        + '</div>'
                        + '<div class="text-muted">Nenhum log para exibir.</div>';
                    return;
                }
                var max = 200;
                var rows = logs.slice(Math.max(0, logs.length - max)).map(function(l){
                    var esc = function(s){ return String(s).replace(/[&<>]/g,function(ch){ return ({'&':'&amp;','<':'&lt;','>':'&gt;'})[ch]; }); };
                    return '<tr>'+
                           '<td style="white-space:nowrap">'+esc(l.timestamp).replace('T',' ').replace('Z','')+'</td>'+
                           '<td><span class="badge badge-'+(l.level==='error'?'danger':(l.level==='warn'?'warning':(l.level==='debug'?'secondary':'info')))+'">'+esc(l.level)+'</span></td>'+
                           '<td style="word-break:break-word">'+esc(l.message)+'</td>'+
                           '</tr>';
                }).join('');
                container.innerHTML = '<div class="d-flex justify-content-between align-items-center mb-2">'
                    + '<small class="text-muted">Total: '+String(totalAll)+' • Filtrados: '+String(totalShown)+'</small>'
                    + '<small class="text-muted">Atualizado: '+new Date().toLocaleTimeString()+'</small>'
                    + '</div>'
                    + '<div class="table-responsive">'+
                    '<table class="table table-sm table-striped mb-0">'+
                    '<thead><tr><th style="width:180px">Tempo</th><th style="width:90px">Nível</th><th>Mensagem</th></tr></thead>'+
                    '<tbody>'+rows+'</tbody>'+
                    '</table></div>';
                try { console.info('[logs] renderLogs executado. total='+String(totalAll)+', mostrados='+String(totalShown)); } catch(_) {}
            }

            function exportLogs(){
                var data = (window.__appLogs || []);
                var blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                var url = URL.createObjectURL(blob);
                var a = document.createElement('a');
                a.href = url;
                a.download = 'logs-'+new Date().toISOString().replace(/[:.]/g,'-')+'.json';
                document.body.appendChild(a);
                a.click();
                setTimeout(function(){ URL.revokeObjectURL(url); a.remove(); }, 500);
            }

            function clearLogs(){
                window.__appLogs = [];
                var container = byId('logs-output');
                if (container) container.innerHTML = '<div class="text-muted">Nenhum log ainda.</div>';
            }

            function init(){
                var btnView = byId('btn-view-logs');
                var btnClear = byId('btn-clear-logs');
                var btnExport = byId('btn-export-logs');
                if (btnView) btnView.addEventListener('click', function(){ console.info('[logs] Visualizar acionado'); renderLogs(); });
                if (btnClear) btnClear.addEventListener('click', function(){ console.info('[logs] Limpar acionado'); clearLogs(); });
                if (btnExport) btnExport.addEventListener('click', function(){ console.info('[logs] Exportar acionado'); exportLogs(); });
                var levelSelect = byId('log-level');
                if (levelSelect) levelSelect.addEventListener('change', function(){ console.info('[logs] Filtro alterado:', levelSelect.value); renderLogs(); });
                // Renderiza automaticamente na inicialização
                try { console.info('[logs] UI inicializada'); renderLogs(); } catch(_) {}
                // Exponho utilitário para acionar via console
                window.showLogsPanel = renderLogs;
            }
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
            } else {
                init();
            }
        })();
    </script>
    
    <!-- Mapa de Ocorrências Script -->
    <script>
        let map;
        let markersGroup;
        let raioCircle;
        
        // Inicializar mapa quando a seção de ocorrências for visível
        function initMap() {
            if (map) return; // Evitar inicialização dupla
            
            try {
                // Coordenadas padrão (Brasília)
                const defaultLat = -15.7942;
                const defaultLng = -47.8822;
                
                // Usar o container específico da seção de ocorrências
                const mapContainer = document.getElementById('map-ocorrencias');
                if (!mapContainer) {
                    console.error('Container do mapa de ocorrências não encontrado: #map-ocorrencias');
                    return;
                }
                
                map = L.map('map-ocorrencias').setView([defaultLat, defaultLng], 10);
                
                // Adicionar camada do mapa
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap contributors',
                    maxZoom: 18
                }).addTo(map);
                
                // Grupo para os marcadores
                markersGroup = L.layerGroup().addTo(map);
                
                // Carregar marcadores das ocorrências
                atualizarMarcadores();
                
                console.log('Mapa inicializado com sucesso');
            } catch (error) {
                console.error('Erro ao inicializar mapa:', error);
            }
        }
        
        // Função para gerar coordenadas baseadas no local
        function getCoordinatesFromLocation(local) {
            // Mapeamento de locais conhecidos para coordenadas
            const knownLocations = {
                'brasília': { lat: -15.7942, lng: -47.8822 },
                'brasilia': { lat: -15.7942, lng: -47.8822 },
                'são paulo': { lat: -23.5505, lng: -46.6333 },
                'sao paulo': { lat: -23.5505, lng: -46.6333 },
                'rio de janeiro': { lat: -22.9068, lng: -43.1729 },
                'belo horizonte': { lat: -19.9191, lng: -43.9378 },
                'salvador': { lat: -12.9714, lng: -38.5014 },
                'fortaleza': { lat: -3.7319, lng: -38.5267 },
                'recife': { lat: -8.0476, lng: -34.8770 },
                'porto alegre': { lat: -30.0346, lng: -51.2177 },
                'curitiba': { lat: -25.4284, lng: -49.2733 },
                'goiânia': { lat: -16.6869, lng: -49.2648 },
                'goiania': { lat: -16.6869, lng: -49.2648 }
            };
            
            const localLower = local.toLowerCase();
            
            // Procurar por correspondência exata
            if (knownLocations[localLower]) {
                const baseCoords = knownLocations[localLower];
                // Adicionar pequena variação para evitar sobreposição
                return {
                    lat: baseCoords.lat + (Math.random() - 0.5) * 0.01,
                    lng: baseCoords.lng + (Math.random() - 0.5) * 0.01
                };
            }
            
            // Procurar por correspondência parcial
            for (const [key, coords] of Object.entries(knownLocations)) {
                if (localLower.includes(key) || key.includes(localLower)) {
                    return {
                        lat: coords.lat + (Math.random() - 0.5) * 0.01,
                        lng: coords.lng + (Math.random() - 0.5) * 0.01
                    };
                }
            }
            
            // Se não encontrar correspondência, usar coordenadas padrão (Brasília) com variação
            return {
                lat: -15.7942 + (Math.random() - 0.5) * 0.1,
                lng: -47.8822 + (Math.random() - 0.5) * 0.1
            };
        }
        
        function renderMarkersList(ocorrencias) {
            if (!map || !markersGroup) return;
            markersGroup.clearLayers();

            const prioridadeColors = {
                'baixa': 'green',
                'media': 'orange',
                'alta': 'red',
                'critica': 'darkred'
            };

            ocorrencias.forEach((ocorrencia) => {
                let lat, lng;
                if (ocorrencia.latitude && ocorrencia.longitude) {
                    lat = ocorrencia.latitude;
                    lng = ocorrencia.longitude;
                } else {
                    const coordinates = getCoordinatesFromLocation(ocorrencia.local || '');
                    lat = coordinates.lat;
                    lng = coordinates.lng;

                    // Persistir coordenadas geradas
                    ocorrencia.latitude = lat;
                    ocorrencia.longitude = lng;
                    const updated = JSON.parse(localStorage.getItem('ocorrencias')) || [];
                    const idx = updated.findIndex(o => o.id === ocorrencia.id);
                    if (idx !== -1) {
                        updated[idx] = ocorrencia;
                        localStorage.setItem('ocorrencias', JSON.stringify(updated));
                    }
                }

                const color = prioridadeColors[ocorrencia.prioridade] || 'blue';
                const customIcon = L.divIcon({
                    className: 'custom-marker',
                    html: `<div style="background-color: ${color}; width: 20px; height: 20px; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);"></div>`,
                    iconSize: [20, 20],
                    iconAnchor: [10, 10]
                });

                const marker = L.marker([lat, lng], { icon: customIcon });
                const popupContent = `
                    <div style="min-width: 200px;">
                        <h6><strong>#${ocorrencia.id} - ${ocorrencia.titulo}</strong></h6>
                        <p><strong>Tipo:</strong> ${ocorrencia.tipo}</p>
                        <p><strong>Prioridade:</strong> <span style="color: ${color}; font-weight: bold;">${ocorrencia.prioridade}</span></p>
                        <p><strong>Local:</strong> ${ocorrencia.local}</p>
                        <p><strong>Responsável:</strong> ${ocorrencia.responsavel}</p>
                        <p><strong>Status:</strong> ${ocorrencia.status}</p>
                        <p><strong>Data:</strong> ${ocorrencia.data}</p>
                        <hr style="margin: 8px 0;">
                        <small><strong>Descrição:</strong><br>${ocorrencia.descricao}</small>
                    </div>
                `;
                marker.bindPopup(popupContent);
                markersGroup.addLayer(marker);
            });

            // Atualizar contador de marcadores no overlay (se existir)
            const totalElem = document.getElementById('totalMarcadoresOcorr');
            if (totalElem) {
                totalElem.textContent = String(ocorrencias.length);
            }

            console.log(`${ocorrencias.length} marcadores renderizados no mapa`);
        }

        function atualizarMarcadores() {
            if (!map || !markersGroup) return;
            const ocorrencias = JSON.parse(localStorage.getItem('ocorrencias')) || [];
            renderMarkersList(ocorrencias);
        }
        
        function centralizarMapa() {
            if (!map) return;
            
            const defaultLat = -15.7942;
            const defaultLng = -47.8822;
            map.setView([defaultLat, defaultLng], 10);
        }
        
        function atualizarMapa() {
            if (!map) {
                initMap();
            } else {
                atualizarMarcadores();
            }
        }
        
        function resizeMap() {
            if (map) {
                setTimeout(() => {
                    map.invalidateSize();
                }, 100);
            }
        }

        // MAPA REMOVIDO - Agora está no listener principal consolidado
        
        // Atualizar mapa quando ocorrências forem modificadas
        const originalRenderOcorrenciasGrid = window.renderOcorrenciasGrid;
        if (originalRenderOcorrenciasGrid) {
            window.renderOcorrenciasGrid = function() {
                originalRenderOcorrenciasGrid();
                setTimeout(() => {
                    atualizarMarcadores();
                }, 100);
            };
        }

        // Controlar exibição dos campos específicos baseado no tipo de ocorrência
        document.getElementById('tipoOcorrencia').addEventListener('change', function() {
            const tipo = this.value;
            const camposVeicular = document.getElementById('camposVeicular');
            const camposPatrimonial = document.getElementById('camposPatrimonial');
            
            // Ocultar todos os campos específicos
            camposVeicular.style.display = 'none';
            camposPatrimonial.style.display = 'none';
            
            // Limpar campos específicos
            clearSpecificFields();
            
            // Mostrar campos baseado no tipo selecionado
            if (tipo === 'veicular') {
                camposVeicular.style.display = 'block';
                setRequiredFields('veicular', true);
            } else if (tipo === 'patrimonial') {
                camposPatrimonial.style.display = 'block';
                setRequiredFields('patrimonial', true);
            }
        });
        
        // Função para limpar campos específicos
        function clearSpecificFields() {
            // Campos veiculares
            document.getElementById('marca').value = '';
            document.getElementById('modelo').value = '';
            document.getElementById('placa').value = '';
            document.getElementById('ano').value = '';
            document.getElementById('cor').value = '';
            document.getElementById('chassi').value = '';
            
            // Campos patrimoniais
            document.getElementById('numeroPatrimonio').value = '';
            document.getElementById('categoria').value = '';
            document.getElementById('valor').value = '';
            document.getElementById('fornecedor').value = '';
            document.getElementById('dataAquisicao').value = '';
            
            // Remover required de todos os campos específicos
            setRequiredFields('veicular', false);
            setRequiredFields('patrimonial', false);
        }
        
        // Função para definir campos obrigatórios
        function setRequiredFields(tipo, required) {
            if (tipo === 'veicular') {
                document.getElementById('marca').required = required;
                document.getElementById('modelo').required = required;
                document.getElementById('placa').required = required;
            } else if (tipo === 'patrimonial') {
                document.getElementById('numeroPatrimonio').required = required;
                document.getElementById('categoria').required = required;
            }
        }
        
        // Função para capturar localização GPS
        function capturarLocalizacaoGPS() {
            const btnGPS = document.getElementById('btnCapturarGPS');
            const localInput = document.getElementById('local');
            
            if (!navigator.geolocation) {
                alert('Geolocalização não é suportada neste navegador.');
                return;
            }
            
            // Mostrar loading no botão
            btnGPS.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Localizando...';
            btnGPS.disabled = true;
            
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    
                    // Armazenar coordenadas para uso posterior
                    window.currentLatitude = lat;
                    window.currentLongitude = lng;
                    
                    // Tentar obter endereço usando reverse geocoding (simulado)
                    const endereco = `Lat: ${lat.toFixed(6)}, Lng: ${lng.toFixed(6)}`;
                    localInput.value = endereco;
                    
                    // Restaurar botão
                    btnGPS.innerHTML = '<i class="fas fa-map-marker-alt"></i> GPS';
                    btnGPS.disabled = false;
                    
                    // Mostrar mensagem de sucesso
                    const alert = document.createElement('div');
                    alert.className = 'alert alert-success alert-dismissible fade show mt-2';
                    alert.innerHTML = `
                        <strong>Localização capturada!</strong> Coordenadas: ${lat.toFixed(6)}, ${lng.toFixed(6)}
                        <button type="button" class="close" data-dismiss="alert">
                            <span>&times;</span>
                        </button>
                    `;
                    localInput.parentNode.parentNode.appendChild(alert);
                    
                    // Remover alerta após 5 segundos
                    setTimeout(() => {
                        if (alert.parentNode) {
                            alert.parentNode.removeChild(alert);
                        }
                    }, 5000);
                },
                function(error) {
                    let errorMessage = 'Erro ao obter localização: ';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage += 'Permissão negada pelo usuário.';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage += 'Localização indisponível.';
                            break;
                        case error.TIMEOUT:
                            errorMessage += 'Tempo limite excedido.';
                            break;
                        default:
                            errorMessage += 'Erro desconhecido.';
                            break;
                    }
                    
                    alert(errorMessage);
                    
                    // Restaurar botão
                    btnGPS.innerHTML = '<i class="fas fa-map-marker-alt"></i> GPS';
                    btnGPS.disabled = false;
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 60000
                }
            );
        }

        // Adicionar event listener para o botão GPS
         document.addEventListener('DOMContentLoaded', function() {
             const btnGPS = document.getElementById('btnCapturarGPS');
             if (btnGPS) {
                 btnGPS.addEventListener('click', capturarLocalizacaoGPS);
             }

             // Atualizar valor do zoom overlay ao iniciar
             const zoomDisplay = document.getElementById('zoomValueOcorr');
             if (zoomDisplay && typeof map !== 'undefined') {
                 zoomDisplay.textContent = map ? String(map.getZoom()) : '10';
             }
         });

         // Filtros e utilitários do mapa de ocorrências
         function filtrarMarcadoresOcorrencias() {
             if (!map || !markersGroup) return;
             const tipo = (document.getElementById('tipoMapaFilterOcorr')?.value || '').toLowerCase();
             const status = (document.getElementById('statusMapaFilterOcorr')?.value || '').toLowerCase();
             const todas = JSON.parse(localStorage.getItem('ocorrencias')) || [];

             const filtradas = todas.filter(o => {
                 const matchesTipo = !tipo || (o.tipo || '').toLowerCase() === tipo;
                 const normalized = (o.status || '').toLowerCase().replace(' ', '-');
                 const matchesStatus = !status || normalized === status;
                 return matchesTipo && matchesStatus;
             });

             renderMarkersList(filtradas);

             // Ajustar o mapa para o conjunto filtrado
             try {
                 if (filtradas.length > 0) {
                     const bounds = L.latLngBounds(filtradas.map(o => [o.latitude || getCoordinatesFromLocation(o.local).lat, o.longitude || getCoordinatesFromLocation(o.local).lng]));
                     map.fitBounds(bounds, { padding: [20, 20] });
                 }
             } catch (e) {
                 console.warn('Não foi possível ajustar bounds do mapa filtrado:', e);
             }
         }

         function alterarZoomOcorrencias(value) {
             if (!map) return;
             const zoom = parseInt(value, 10);
             map.setZoom(zoom);
             const display = document.getElementById('zoomValueOcorr');
             if (display) display.textContent = String(zoom);
         }

         function alternarRaioOcorrencias() {
             if (!map) return;
             const checked = document.getElementById('mostrarRaioOcorr')?.checked;
             if (checked) {
                 const center = map.getCenter();
                 if (raioCircle) {
                     raioCircle.setLatLng(center);
                 } else {
                     raioCircle = L.circle(center, { radius: 1000, color: '#007bff', fillColor: '#007bff', fillOpacity: 0.1 });
                     raioCircle.addTo(map);
                 }
             } else {
                 if (raioCircle) {
                     map.removeLayer(raioCircle);
                     raioCircle = null;
                 }
             }
         }

         function verTodasMarcadoresOcorrencias() {
             atualizarMarcadores();
             try {
                 if (markersGroup && markersGroup.getLayers().length > 0) {
                     map.fitBounds(markersGroup.getBounds(), { padding: [20, 20] });
                 }
             } catch (e) {
                 console.warn('Não foi possível ajustar bounds para todos os marcadores:', e);
             }
         }

         function ocultarMarcadoresOcorrencias() {
             if (!markersGroup) return;
             markersGroup.clearLayers();
             const totalElem = document.getElementById('totalMarcadoresOcorr');
             if (totalElem) totalElem.textContent = '0';
         }

         function buscarEnderecoOcorrencias(event) {
             if (event.key !== 'Enter') return;
             const valor = document.getElementById('enderecoInputOcorr')?.value || '';
             if (!valor.trim()) return;
             const coords = getCoordinatesFromLocation(valor.trim());
             if (map) {
                 map.setView([coords.lat, coords.lng], Math.max(map.getZoom(), 13));
             }
         }
         
         // Função para localizar ocorrência no mapa
         function localizarNoMapa(ocorrenciaId) {
             const ocorrencias = JSON.parse(localStorage.getItem('ocorrencias')) || [];
             const ocorrencia = ocorrencias.find(o => o.id === ocorrenciaId);
             
             if (!ocorrencia) {
                 alert('Ocorrência não encontrada!');
                 return;
             }
             
             let lat, lng;
             
             // Usar coordenadas da ocorrência ou gerar baseado no local
             if (ocorrencia.latitude && ocorrencia.longitude) {
                 lat = ocorrencia.latitude;
                 lng = ocorrencia.longitude;
             } else {
                 const coordinates = getCoordinatesFromLocation(ocorrencia.local);
                 lat = coordinates.lat;
                 lng = coordinates.lng;
             }
             
             // Verificar se o mapa está inicializado
             if (!map) {
                 // Tentar inicializar o mapa se não estiver
                 if (typeof initMap === 'function') {
                     initMap();
                 }
                 
                 // Aguardar um pouco para o mapa inicializar
                 setTimeout(() => {
                     if (map) {
                         centralizarMapa(lat, lng, ocorrencia);
                     } else {
                         alert('Mapa não está disponível. Verifique se a seção do mapa está carregada.');
                     }
                 }, 1000);
             } else {
                 centralizarMapa(lat, lng, ocorrencia);
             }
             
             // Rolar para a seção do mapa
             const mapaSection = document.querySelector('#map-ocorrencias');
             if (mapaSection) {
                 mapaSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
             }
         }
         
         // Função auxiliar para centralizar o mapa
         function centralizarMapa(lat, lng, ocorrencia) {
             if (!map) return;
             const latIsValid = typeof lat === 'number' && !isNaN(lat);
             const lngIsValid = typeof lng === 'number' && !isNaN(lng);
             
             // Se não houver coordenadas válidas, centraliza no padrão (Brasília)
             if (!latIsValid || !lngIsValid) {
                 const defaultLat = -15.7942;
                 const defaultLng = -47.8822;
                 map.setView([defaultLat, defaultLng], 10);
                 return;
             }
             
             // Centralizar o mapa nas coordenadas fornecidas
             map.setView([lat, lng], 16);
             
             // Destacar o marcador da ocorrência
             if (markersGroup) {
                 markersGroup.eachLayer(function(marker) {
                     const markerLatLng = marker.getLatLng();
                     const distance = map.distance([lat, lng], [markerLatLng.lat, markerLatLng.lng]);
                     
                     // Se o marcador está próximo às coordenadas da ocorrência (dentro de 100m)
                     if (distance < 100) {
                         // Abrir popup do marcador
                         marker.openPopup();
                         
                         // Adicionar efeito visual temporário
                         const markerElement = marker.getElement();
                         if (markerElement) {
                             markerElement.style.animation = 'pulse 2s infinite';
                             setTimeout(() => {
                                 markerElement.style.animation = '';
                             }, 6000);
                         }
                     }
                 });
             }
             
             // Mostrar mensagem de sucesso
             const alert = document.createElement('div');
             alert.className = 'alert alert-info alert-dismissible fade show';
             alert.style.position = 'fixed';
             alert.style.top = '20px';
             alert.style.right = '20px';
             alert.style.zIndex = '9999';
             alert.style.minWidth = '300px';
             alert.innerHTML = `
                 <strong>Localização encontrada!</strong><br>
                 Ocorrência #${ocorrencia.id} - ${ocorrencia.titulo}
                 <button type="button" class="close" onclick="this.parentElement.remove()">
                     <span>&times;</span>
                 </button>
             `;
             document.body.appendChild(alert);
             
             // Remover alerta após 5 segundos
             setTimeout(() => {
                 if (alert.parentNode) {
                     alert.parentNode.removeChild(alert);
                 }
             }, 5000);
         }
        
        // Atualizar função de cadastro para incluir campos específicos
        const originalCadastroForm = document.getElementById('cadastroForm');
        if (originalCadastroForm) {
            originalCadastroForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const tipo = document.getElementById('tipoOcorrencia').value;
                const titulo = document.getElementById('titulo').value;
                const descricao = document.getElementById('descricao').value;
                const local = document.getElementById('local').value;
                const responsavel = document.getElementById('responsavel').value;
                const prioridade = document.getElementById('prioridade').value;
                
                const ocorrencia = {
                    id: 'OC' + String(ocorrencias.length + 1).padStart(3, '0'),
                    tipo: tipo,
                    titulo: titulo,
                    descricao: descricao,
                    local: local,
                    responsavel: responsavel,
                    prioridade: prioridade,
                    status: 'pendente',
                    data: new Date().toLocaleDateString('pt-BR')
                };
                
                // Adicionar coordenadas GPS se disponíveis
                if (window.currentLatitude && window.currentLongitude) {
                    ocorrencia.latitude = window.currentLatitude;
                    ocorrencia.longitude = window.currentLongitude;
                    
                    // Limpar coordenadas temporárias
                    delete window.currentLatitude;
                    delete window.currentLongitude;
                }
                
                // Adicionar campos específicos baseado no tipo
                if (tipo === 'veicular') {
                    ocorrencia.detalhesEspecificos = {
                        marca: document.getElementById('marca').value,
                        modelo: document.getElementById('modelo').value,
                        placa: document.getElementById('placa').value,
                        ano: document.getElementById('ano').value,
                        cor: document.getElementById('cor').value,
                        chassi: document.getElementById('chassi').value
                    };
                } else if (tipo === 'patrimonial') {
                    ocorrencia.detalhesEspecificos = {
                        numeroPatrimonio: document.getElementById('numeroPatrimonio').value,
                        categoria: document.getElementById('categoria').value,
                        valor: document.getElementById('valor').value,
                        fornecedor: document.getElementById('fornecedor').value,
                        dataAquisicao: document.getElementById('dataAquisicao').value
                    };
                }
                
                ocorrencias.push(ocorrencia);
                localStorage.setItem('ocorrencias', JSON.stringify(ocorrencias));
                renderOcorrenciasGrid();
                
                // Atualizar mapa se estiver inicializado
                if (typeof atualizarMarcadores === 'function') {
                    atualizarMarcadores();
                }
                
                // Limpar formulário
                this.reset();
                limparCamposEspecificos();
                
                // Fechar modal
                $('#cadastroModal').modal('hide');
                
                // Mostrar mensagem de sucesso
                showAlert('Ocorrência cadastrada com sucesso!', 'success');
            });
        }
        
        // Função para filtrar ocorrências
        function filtrarOcorrencias() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const tipoFilter = document.getElementById('tipoFilter').value;
            const prioridadeFilter = document.getElementById('prioridadeFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            
            const tbody = document.getElementById('ocorrenciasTableBody');
            const rows = tbody.getElementsByTagName('tr');
            
            let visibleRows = 0;
            
            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                
                // Pular a linha "Nenhuma ocorrência cadastrada"
                if (row.id === 'noOccurrencesRow') continue;
                
                const cells = row.getElementsByTagName('td');
                if (cells.length === 0) continue;
                
                const tipo = cells[1].textContent.toLowerCase();
                const titulo = cells[2].textContent.toLowerCase();
                const prioridade = cells[4].textContent.toLowerCase();
                const local = cells[5].textContent.toLowerCase();
                const responsavel = cells[6].textContent.toLowerCase();
                const status = cells[7].textContent.toLowerCase();
                
                // Verificar se a linha atende aos critérios de filtro
                const matchesSearch = searchTerm === '' || 
                    titulo.includes(searchTerm) || 
                    local.includes(searchTerm) || 
                    responsavel.includes(searchTerm);
                    
                const matchesTipo = tipoFilter === '' || tipo === tipoFilter;
                const matchesPrioridade = prioridadeFilter === '' || prioridade === prioridadeFilter;
                const matchesStatus = statusFilter === '' || status.replace(' ', '-') === statusFilter;
                
                if (matchesSearch && matchesTipo && matchesPrioridade && matchesStatus) {
                    row.style.display = '';
                    visibleRows++;
                } else {
                    row.style.display = 'none';
                }
            }
            
            // Mostrar/ocultar mensagem "Nenhuma ocorrência encontrada"
            const noOccurrencesRow = document.getElementById('noOccurrencesRow');
            if (visibleRows === 0 && ocorrencias.length > 0) {
                // Criar linha temporária para "Nenhuma ocorrência encontrada"
                let noResultsRow = document.getElementById('noResultsRow');
                if (!noResultsRow) {
                    noResultsRow = document.createElement('tr');
                    noResultsRow.id = 'noResultsRow';
                    noResultsRow.innerHTML = `
                        <td colspan="10" class="text-center text-muted">
                            <i class="fas fa-search fa-2x mb-2"></i><br>
                            Nenhuma ocorrência encontrada com os filtros aplicados
                        </td>
                    `;
                    tbody.appendChild(noResultsRow);
                }
                noResultsRow.style.display = '';
            } else {
                const noResultsRow = document.getElementById('noResultsRow');
                if (noResultsRow) {
                    noResultsRow.style.display = 'none';
                }
            }
        }
        
        // Função para limpar filtros
        function limparFiltros() {
            document.getElementById('searchInput').value = '';
            document.getElementById('tipoFilter').value = '';
            document.getElementById('prioridadeFilter').value = '';
            document.getElementById('statusFilter').value = '';
            
            // Mostrar todas as linhas
            const tbody = document.getElementById('ocorrenciasTableBody');
            const rows = tbody.getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                if (row.id !== 'noResultsRow') {
                    row.style.display = '';
                }
            }
            
            // Ocultar mensagem "Nenhuma ocorrência encontrada"
            const noResultsRow = document.getElementById('noResultsRow');
            if (noResultsRow) {
                noResultsRow.style.display = 'none';
            }
        }
    </script>

    <!-- Layout agora é controlado por CSS Grid; script de largura removido -->
    <!-- Modal de Ocorrência -->
    <div id="modal-ocorrencia" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="modal-ocorrencia-title" aria-describedby="modal-ocorrencia-desc" aria-hidden="true">
      <div id="modal-content-ocorrencia" class="modal-content">
        <div class="modal-header">
          <h3 id="modal-ocorrencia-title"><i class="bx bx-file mr-2"></i> Novo Cadastro</h3>
          <button id="close-ocorrencia-modal" class="close-modal" aria-label="Fechar">
            <span>&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p id="modal-ocorrencia-desc" class="text-muted">Preencha os campos do formulário. Pressione Esc para fechar. Use Tab para navegar entre os campos.</p>
          <!-- Conteúdo do formulário será inserido dinamicamente -->
        </div>
        <div class="modal-footer">
          <!-- Footer do modal gerenciado pelos formulários -->
        </div>
      </div>
    </div>
    <!-- Modal de Notificações -->
    <div id="notifications-modal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="notifications-modal-title" aria-describedby="notifications-modal-desc" aria-hidden="true">
      <div class="modal-content notifications-modal">
        <div class="modal-header">
          <h3 id="notifications-modal-title"><i class="fas fa-bell mr-2"></i> Notificações</h3>
          <button id="close-notifications" class="close-modal" aria-label="Fechar">
            <span>&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p id="notifications-modal-desc" class="text-muted">Visualize e gerencie suas notificações. Pressione Esc para fechar.</p>
          <!-- Itens de notificação serão inseridos dinamicamente -->
          <div class="notification-item info">
            <div class="notification-icon info"><i class="bx bx-info-circle"></i></div>
            <div class="notification-content">
              <h4>Bem-vindo!</h4>
              <p>Seu centro de notificações está pronto.</p>
              <span class="notification-time">agora</span>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button id="mark-all-read" class="btn btn-primary">
            <i class="bx bx-check"></i> Marcar todas como lidas
          </button>
        </div>
      </div>
    </div>
  </body>
  </html>
